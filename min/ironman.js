var SH=SH||{};SH.Creature={Type:{Character:"Character",Monster:"Monster"},Name:{Character:{IronMan:"IronMan"},Monsters:{Alpha:"Alpha",Beta:"Beta",Charlie:"Charlie"}}},SH.MONSTERSNAME=SH.Creature.Name.Monsters,SH.CHARACTERSNAME=SH.Creature.Name.Character,SH.FPS=30,SH.Character={Ironman:"Ironman"},SH.Weapon={Characters:{Rifle:"Rifle",Rocket:"Rocket",Electric:"Electric"},Monster:{Rifle:"RifleMonsterWeapon"}},SH.Bullet={Characters:{Rifle:"Rifle",Rocket:"Rocket",Electric:"Electric"},Monster:{Rifle:"RifleMonsterBullet"}};var USK=UMStorageKey={GameInfo:{name:"GameInfo",type:"json"},PlayInfo:{name:"PlayInfo",type:"json"}};var CharacterConfig={Ironman:{res:"#ironman.png",HP:100,scale:.4,speed:5,weaponFire:{aniRate:.05,scale:2,frames:["weaponRifleFire1.png","weaponRifleFire2.png"],buffer:{x:150,y:100}}}};var MonsterConfig={Alpha:{resId:101,presetAmount:99,scale:.5,framesData:{Move:["Alpha_1.png"],Attack:["Alpha_2.png","Alpha_1.png","Alpha_3.png","Alpha_1.png"],speed:2},values:{}},Beta:{resId:102,presetAmount:99,scale:.5,framesData:{Move:["Beta_1.png"],Attack:["Beta_5.png"],speed:2.5},values:{}},Charlie:{resId:103,presetAmount:99,scale:.5,weaponFire:{aniRate:.05,scale:2,frames:["weaponRifleFire1.png","weaponRifleFire2.png"],buffer:{x:150,y:100}},framesData:{Move:["alpha.png"],speed:2.5},values:{}}};var WeaponConfig={Rifle:{shootStep:10,bullets:{presetAmount:10,res:"#bulletRifle.png",speed:15}},Rocket:{shootStep:30,res:"#Rocket.png",bullets:{presetAmount:10,res:"#RocketBullet.png",speed:5,explode:{frames:["rocketEffect00.png","rocketEffect01.png","rocketEffect02.png","rocketEffect03.png","rocketEffect04.png","rocketEffect05.png","rocketEffect06.png"],speed:2.5}}},Electric:{shootStep:15,bullets:{presetAmount:10,frames:["00000.png","00001.png","00002.png","00003.png","00004.png","00005.png","00006.png"],speed:8}},MonsterRifle:{shootStep:60,bullets:{dps:1,scale:.4,presetAmount:10,res:"#bulletRifle.png",speed:5}}};var SC=SH.CUSTOMEVENTS={CHARACTER_DIE:"CHARACTER_DIE",CHARACTER_UPDATE_BULLET:"CHARACTER_UPDATE_BULLET",CHARACTER_EXCUTE_SKILL:"CHARACTER_EXCUTE_SKILL",CHARACTER_RESURRECTION:"CHARACTER_RESURRECTION",CHARACTER_GIVEUP_RESURRECTION:"CHARACTER_GIVEUP_RESURRECTION",CHARACTER_SET_WEAPON:"CHRACTER_SET_WEAPON",CHARACTER_RESET_WEAPON:"CHRACTER_RESET_WEAPON",CHARACTER_BOMB:"CHARACTER_BOMB",CHARACTER_FREEZE:"CHARACTER_FREEZE",CHARACTER_SHIEL:"CHARACTER_SHIEL",HP_UPDATE:"HP_UPDATE",IRONMAN_DIE:"IRONMAN_DIE",MONSTER_DIE:"MONSTER_DIE",MONSTER_HIT:"MONSTER_HIT",MONSTER_HIT_CHARACTER:"MONSTER_HIT_CHARACTER",BATTLE_START:"BATTLE_START",BATTLE_PAUSE:"BATTLE_PAUSE",BATTLE_RESUME:"BATTLE_RESUME",BATTLE_STOP:"BATTLE_STOP",BATTLE_ROUND_UPDATE:"BATTLE_ROUND_UPDATE",BATTLE_SHAKE:"BATTLE_SHAKE",BATTLE_END:"BATTLE_END",DROPITEM_GET:"DROPITEM_GET",DROP_COIN:"DROP_COIN",DROP_MONEY:"DROP_MONEY",SYSTEM_TABS_UPDATE:"SYSTEM_TABS_UPDATE",TRIGGER_SKILL:"TRIGGER_SKILL",GAME_START:"GAME_START"},SG=SH.GLOBALEVENTS={PAY_CALLBACK:"PAY_CALLBACK"};function hex_md5(e){return rstr2hex(rstr_md5(str2rstr_utf8(e)))}function b64_md5(e){return rstr2b64(rstr_md5(str2rstr_utf8(e)))}function any_md5(e,t){return rstr2any(rstr_md5(str2rstr_utf8(e)),t)}function hex_hmac_md5(e,t){return rstr2hex(rstr_hmac_md5(str2rstr_utf8(e),str2rstr_utf8(t)))}function b64_hmac_md5(e,t){return rstr2b64(rstr_hmac_md5(str2rstr_utf8(e),str2rstr_utf8(t)))}function any_hmac_md5(e,t,n){return rstr2any(rstr_hmac_md5(str2rstr_utf8(e),str2rstr_utf8(t)),n)}function md5_vm_test(){return hex_md5("abc").toLowerCase()=="900150983cd24fb0d6963f7d28e17f72"}function rstr_md5(e){return binl2rstr(binl_md5(rstr2binl(e),e.length*8))}function rstr_hmac_md5(e,t){var n=rstr2binl(e);n.length>16&&(n=binl_md5(n,e.length*8));var r=Array(16),i=Array(16);for(var s=0;s<16;s++)r[s]=n[s]^909522486,i[s]=n[s]^1549556828;var o=binl_md5(r.concat(rstr2binl(t)),512+t.length*8);return binl2rstr(binl_md5(i.concat(o),640))}function rstr2hex(e){try{hexcase}catch(t){hexcase=0}var n=hexcase?"0123456789ABCDEF":"0123456789abcdef",r="",i;for(var s=0;s<e.length;s++)i=e.charCodeAt(s),r+=n.charAt(i>>>4&15)+n.charAt(i&15);return r}function rstr2b64(e){try{b64pad}catch(t){b64pad=""}var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="",i=e.length;for(var s=0;s<i;s+=3){var o=e.charCodeAt(s)<<16|(s+1<i?e.charCodeAt(s+1)<<8:0)|(s+2<i?e.charCodeAt(s+2):0);for(var u=0;u<4;u++)s*8+u*6>e.length*8?r+=b64pad:r+=n.charAt(o>>>6*(3-u)&63)}return r}function rstr2any(e,t){var n=t.length,r,i,s,o,u,a=Array(Math.ceil(e.length/2));for(r=0;r<a.length;r++)a[r]=e.charCodeAt(r*2)<<8|e.charCodeAt(r*2+1);var f=Math.ceil(e.length*8/(Math.log(t.length)/Math.log(2))),l=Array(f);for(i=0;i<f;i++){u=Array(),o=0;for(r=0;r<a.length;r++){o=(o<<16)+a[r],s=Math.floor(o/n),o-=s*n;if(u.length>0||s>0)u[u.length]=s}l[i]=o,a=u}var c="";for(r=l.length-1;r>=0;r--)c+=t.charAt(l[r]);return c}function str2rstr_utf8(e){var t="",n=-1,r,i;while(++n<e.length)r=e.charCodeAt(n),i=n+1<e.length?e.charCodeAt(n+1):0,55296<=r&&r<=56319&&56320<=i&&i<=57343&&(r=65536+((r&1023)<<10)+(i&1023),n++),r<=127?t+=String.fromCharCode(r):r<=2047?t+=String.fromCharCode(192|r>>>6&31,128|r&63):r<=65535?t+=String.fromCharCode(224|r>>>12&15,128|r>>>6&63,128|r&63):r<=2097151&&(t+=String.fromCharCode(240|r>>>18&7,128|r>>>12&63,128|r>>>6&63,128|r&63));return t}function str2rstr_utf16le(e){var t="";for(var n=0;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)&255,e.charCodeAt(n)>>>8&255);return t}function str2rstr_utf16be(e){var t="";for(var n=0;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)>>>8&255,e.charCodeAt(n)&255);return t}function rstr2binl(e){var t=Array(e.length>>2);for(var n=0;n<t.length;n++)t[n]=0;for(var n=0;n<e.length*8;n+=8)t[n>>5]|=(e.charCodeAt(n/8)&255)<<n%32;return t}function binl2rstr(e){var t="";for(var n=0;n<e.length*32;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}function binl_md5(e,t){e[t>>5]|=128<<t%32,e[(t+64>>>9<<4)+14]=t;var n=1732584193,r=-271733879,i=-1732584194,s=271733878;for(var o=0;o<e.length;o+=16){var u=n,a=r,f=i,l=s;n=md5_ff(n,r,i,s,e[o+0],7,-680876936),s=md5_ff(s,n,r,i,e[o+1],12,-389564586),i=md5_ff(i,s,n,r,e[o+2],17,606105819),r=md5_ff(r,i,s,n,e[o+3],22,-1044525330),n=md5_ff(n,r,i,s,e[o+4],7,-176418897),s=md5_ff(s,n,r,i,e[o+5],12,1200080426),i=md5_ff(i,s,n,r,e[o+6],17,-1473231341),r=md5_ff(r,i,s,n,e[o+7],22,-45705983),n=md5_ff(n,r,i,s,e[o+8],7,1770035416),s=md5_ff(s,n,r,i,e[o+9],12,-1958414417),i=md5_ff(i,s,n,r,e[o+10],17,-42063),r=md5_ff(r,i,s,n,e[o+11],22,-1990404162),n=md5_ff(n,r,i,s,e[o+12],7,1804603682),s=md5_ff(s,n,r,i,e[o+13],12,-40341101),i=md5_ff(i,s,n,r,e[o+14],17,-1502002290),r=md5_ff(r,i,s,n,e[o+15],22,1236535329),n=md5_gg(n,r,i,s,e[o+1],5,-165796510),s=md5_gg(s,n,r,i,e[o+6],9,-1069501632),i=md5_gg(i,s,n,r,e[o+11],14,643717713),r=md5_gg(r,i,s,n,e[o+0],20,-373897302),n=md5_gg(n,r,i,s,e[o+5],5,-701558691),s=md5_gg(s,n,r,i,e[o+10],9,38016083),i=md5_gg(i,s,n,r,e[o+15],14,-660478335),r=md5_gg(r,i,s,n,e[o+4],20,-405537848),n=md5_gg(n,r,i,s,e[o+9],5,568446438),s=md5_gg(s,n,r,i,e[o+14],9,-1019803690),i=md5_gg(i,s,n,r,e[o+3],14,-187363961),r=md5_gg(r,i,s,n,e[o+8],20,1163531501),n=md5_gg(n,r,i,s,e[o+13],5,-1444681467),s=md5_gg(s,n,r,i,e[o+2],9,-51403784),i=md5_gg(i,s,n,r,e[o+7],14,1735328473),r=md5_gg(r,i,s,n,e[o+12],20,-1926607734),n=md5_hh(n,r,i,s,e[o+5],4,-378558),s=md5_hh(s,n,r,i,e[o+8],11,-2022574463),i=md5_hh(i,s,n,r,e[o+11],16,1839030562),r=md5_hh(r,i,s,n,e[o+14],23,-35309556),n=md5_hh(n,r,i,s,e[o+1],4,-1530992060),s=md5_hh(s,n,r,i,e[o+4],11,1272893353),i=md5_hh(i,s,n,r,e[o+7],16,-155497632),r=md5_hh(r,i,s,n,e[o+10],23,-1094730640),n=md5_hh(n,r,i,s,e[o+13],4,681279174),s=md5_hh(s,n,r,i,e[o+0],11,-358537222),i=md5_hh(i,s,n,r,e[o+3],16,-722521979),r=md5_hh(r,i,s,n,e[o+6],23,76029189),n=md5_hh(n,r,i,s,e[o+9],4,-640364487),s=md5_hh(s,n,r,i,e[o+12],11,-421815835),i=md5_hh(i,s,n,r,e[o+15],16,530742520),r=md5_hh(r,i,s,n,e[o+2],23,-995338651),n=md5_ii(n,r,i,s,e[o+0],6,-198630844),s=md5_ii(s,n,r,i,e[o+7],10,1126891415),i=md5_ii(i,s,n,r,e[o+14],15,-1416354905),r=md5_ii(r,i,s,n,e[o+5],21,-57434055),n=md5_ii(n,r,i,s,e[o+12],6,1700485571),s=md5_ii(s,n,r,i,e[o+3],10,-1894986606),i=md5_ii(i,s,n,r,e[o+10],15,-1051523),r=md5_ii(r,i,s,n,e[o+1],21,-2054922799),n=md5_ii(n,r,i,s,e[o+8],6,1873313359),s=md5_ii(s,n,r,i,e[o+15],10,-30611744),i=md5_ii(i,s,n,r,e[o+6],15,-1560198380),r=md5_ii(r,i,s,n,e[o+13],21,1309151649),n=md5_ii(n,r,i,s,e[o+4],6,-145523070),s=md5_ii(s,n,r,i,e[o+11],10,-1120210379),i=md5_ii(i,s,n,r,e[o+2],15,718787259),r=md5_ii(r,i,s,n,e[o+9],21,-343485551),n=safe_add(n,u),r=safe_add(r,a),i=safe_add(i,f),s=safe_add(s,l)}return Array(n,r,i,s)}function md5_cmn(e,t,n,r,i,s){return safe_add(bit_rol(safe_add(safe_add(t,e),safe_add(r,s)),i),n)}function md5_ff(e,t,n,r,i,s,o){return md5_cmn(t&n|~t&r,e,t,i,s,o)}function md5_gg(e,t,n,r,i,s,o){return md5_cmn(t&r|n&~r,e,t,i,s,o)}function md5_hh(e,t,n,r,i,s,o){return md5_cmn(t^n^r,e,t,i,s,o)}function md5_ii(e,t,n,r,i,s,o){return md5_cmn(n^(t|~r),e,t,i,s,o)}function safe_add(e,t){var n=(e&65535)+(t&65535),r=(e>>16)+(t>>16)+(n>>16);return r<<16|n&65535}function bit_rol(e,t){return e<<t|e>>>32-t}var hexcase=0,b64pad="";var uuid=function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),t=new Array(36),n=0,r;for(var i=0;i<36;i++)i==8||i==13||i==18||i==23?t[i]="-":i==14?t[i]="4":(n<=2&&(n=33554432+Math.random()*16777216|0),r=n&15,n>>=4,t[i]=e[i==19?r&3|8:r]);return t.join("")},dechex=function(e){return _.isNumber(e)?parseInt(e.toString(),10).toString(16):null},decbin=function(e){return _.isNumber(e)?parseInt(e.toString(),10).toString(2):null},bindec=function(e){return _.isString(e)?parseInt(e,2):null},hexdec=function(e){return parseInt(e,16)},chr=function(e){return String.fromCharCode(e)},ord=function(e){return e.charCodeAt()};(function(){var e=this,t=e._,n=Array.prototype,r=Object.prototype,i=Function.prototype,s=n.push,o=n.slice,u=n.concat,a=r.toString,f=r.hasOwnProperty,l=Array.isArray,c=Object.keys,h=i.bind,p=function(e){return e instanceof p?e:this instanceof p?void (this._wrapped=e):new p(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=p),exports._=p):e._=p,p.VERSION="1.7.0";var d=function(e,t,n){if(t===void 0)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,s){return e.call(t,n,r,i,s)}}return function(){return e.apply(t,arguments)}};p.iteratee=function(e,t,n){return null==e?p.identity:p.isFunction(e)?d(e,t,n):p.isObject(e)?p.matches(e):p.property(e)},p.each=p.forEach=function(e,t,n){if(null==e)return e;t=d(t,n);var r,i=e.length;if(i===+i)for(r=0;i>r;r++)t(e[r],r,e);else{var s=p.keys(e);for(r=0,i=s.length;i>r;r++)t(e[s[r]],s[r],e)}return e},p.map=p.collect=function(e,t,n){if(null==e)return[];t=p.iteratee(t,n);for(var r,i=e.length!==+e.length&&p.keys(e),s=(i||e).length,o=Array(s),u=0;s>u;u++)r=i?i[u]:u,o[u]=t(e[r],r,e);return o};var v="Reduce of empty array with no initial value";p.reduce=p.foldl=p.inject=function(e,t,n,r){null==e&&(e=[]),t=d(t,r,4);var i,s=e.length!==+e.length&&p.keys(e),o=(s||e).length,u=0;if(arguments.length<3){if(!o)throw new TypeError(v);n=e[s?s[u++]:u++]}for(;o>u;u++)i=s?s[u]:u,n=t(n,e[i],i,e);return n},p.reduceRight=p.foldr=function(e,t,n,r){null==e&&(e=[]),t=d(t,r,4);var i,s=e.length!==+e.length&&p.keys(e),o=(s||e).length;if(arguments.length<3){if(!o)throw new TypeError(v);n=e[s?s[--o]:--o]}for(;o--;)i=s?s[o]:o,n=t(n,e[i],i,e);return n},p.find=p.detect=function(e,t,n){var r;return t=p.iteratee(t,n),p.some(e,function(e,n,i){return t(e,n,i)?(r=e,!0):void 0}),r},p.filter=p.select=function(e,t,n){var r=[];return null==e?r:(t=p.iteratee(t,n),p.each(e,function(e,n,i){t(e,n,i)&&r.push(e)}),r)},p.reject=function(e,t,n){return p.filter(e,p.negate(p.iteratee(t)),n)},p.every=p.all=function(e,t,n){if(null==e)return!0;t=p.iteratee(t,n);var r,i,s=e.length!==+e.length&&p.keys(e),o=(s||e).length;for(r=0;o>r;r++)if(i=s?s[r]:r,!t(e[i],i,e))return!1;return!0},p.some=p.any=function(e,t,n){if(null==e)return!1;t=p.iteratee(t,n);var r,i,s=e.length!==+e.length&&p.keys(e),o=(s||e).length;for(r=0;o>r;r++)if(i=s?s[r]:r,t(e[i],i,e))return!0;return!1},p.contains=p.include=function(e,t){return null==e?!1:(e.length!==+e.length&&(e=p.values(e)),p.indexOf(e,t)>=0)},p.invoke=function(e,t){var n=o.call(arguments,2),r=p.isFunction(t);return p.map(e,function(e){return(r?t:e[t]).apply(e,n)})},p.pluck=function(e,t){return p.map(e,p.property(t))},p.where=function(e,t){return p.filter(e,p.matches(t))},p.findWhere=function(e,t){return p.find(e,p.matches(t))},p.max=function(e,t,n){var r,i,s=-1/0,o=-1/0;if(null==t&&null!=e){e=e.length===+e.length?e:p.values(e);for(var u=0,a=e.length;a>u;u++)r=e[u],r>s&&(s=r)}else t=p.iteratee(t,n),p.each(e,function(e,n,r){i=t(e,n,r),(i>o||i===-1/0&&s===-1/0)&&(s=e,o=i)});return s},p.min=function(e,t,n){var r,i,s=1/0,o=1/0;if(null==t&&null!=e){e=e.length===+e.length?e:p.values(e);for(var u=0,a=e.length;a>u;u++)r=e[u],s>r&&(s=r)}else t=p.iteratee(t,n),p.each(e,function(e,n,r){i=t(e,n,r),(o>i||1/0===i&&1/0===s)&&(s=e,o=i)});return s},p.shuffle=function(e){for(var t,n=e&&e.length===+e.length?e:p.values(e),r=n.length,i=Array(r),s=0;r>s;s++)t=p.random(0,s),t!==s&&(i[s]=i[t]),i[t]=n[s];return i},p.sample=function(e,t,n){return null==t||n?(e.length!==+e.length&&(e=p.values(e)),e[p.random(e.length-1)]):p.shuffle(e).slice(0,Math.max(0,t))},p.sortBy=function(e,t,n){return t=p.iteratee(t,n),p.pluck(p.map(e,function(e,n,r){return{value:e,index:n,criteria:t(e,n,r)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(r>n||r===void 0)return-1}return e.index-t.index}),"value")};var m=function(e){return function(t,n,r){var i={};return n=p.iteratee(n,r),p.each(t,function(r,s){var o=n(r,s,t);e(i,r,o)}),i}};p.groupBy=m(function(e,t,n){p.has(e,n)?e[n].push(t):e[n]=[t]}),p.indexBy=m(function(e,t,n){e[n]=t}),p.countBy=m(function(e,t,n){p.has(e,n)?e[n]++:e[n]=1}),p.sortedIndex=function(e,t,n,r){n=p.iteratee(n,r,1);for(var i=n(t),s=0,o=e.length;o>s;){var u=s+o>>>1;n(e[u])<i?s=u+1:o=u}return s},p.toArray=function(e){return e?p.isArray(e)?o.call(e):e.length===+e.length?p.map(e,p.identity):p.values(e):[]},p.size=function(e){return null==e?0:e.length===+e.length?e.length:p.keys(e).length},p.partition=function(e,t,n){t=p.iteratee(t,n);var r=[],i=[];return p.each(e,function(e,n,s){(t(e,n,s)?r:i).push(e)}),[r,i]},p.first=p.head=p.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:0>t?[]:o.call(e,0,t)},p.initial=function(e,t,n){return o.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))},p.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:o.call(e,Math.max(e.length-t,0))},p.rest=p.tail=p.drop=function(e,t,n){return o.call(e,null==t||n?1:t)},p.compact=function(e){return p.filter(e,p.identity)};var g=function(e,t,n,r){if(t&&p.every(e,p.isArray))return u.apply(r,e);for(var i=0,o=e.length;o>i;i++){var a=e[i];p.isArray(a)||p.isArguments(a)?t?s.apply(r,a):g(a,t,n,r):n||r.push(a)}return r};p.flatten=function(e,t){return g(e,t,!1,[])},p.without=function(e){return p.difference(e,o.call(arguments,1))},p.uniq=p.unique=function(e,t,n,r){if(null==e)return[];p.isBoolean(t)||(r=n,n=t,t=!1),null!=n&&(n=p.iteratee(n,r));for(var i=[],s=[],o=0,u=e.length;u>o;o++){var a=e[o];if(t)o&&s===a||i.push(a),s=a;else if(n){var f=n(a,o,e);p.indexOf(s,f)<0&&(s.push(f),i.push(a))}else p.indexOf(i,a)<0&&i.push(a)}return i},p.union=function(){return p.uniq(g(arguments,!0,!0,[]))},p.intersection=function(e){if(null==e)return[];for(var t=[],n=arguments.length,r=0,i=e.length;i>r;r++){var s=e[r];if(!p.contains(t,s)){for(var o=1;n>o&&p.contains(arguments[o],s);o++);o===n&&t.push(s)}}return t},p.difference=function(e){var t=g(o.call(arguments,1),!0,!0,[]);return p.filter(e,function(e){return!p.contains(t,e)})},p.zip=function(e){if(null==e)return[];for(var t=p.max(arguments,"length").length,n=Array(t),r=0;t>r;r++)n[r]=p.pluck(arguments,r);return n},p.object=function(e,t){if(null==e)return{};for(var n={},r=0,i=e.length;i>r;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},p.indexOf=function(e,t,n){if(null==e)return-1;var r=0,i=e.length;if(n){if("number"!=typeof n)return r=p.sortedIndex(e,t),e[r]===t?r:-1;r=0>n?Math.max(0,i+n):n}for(;i>r;r++)if(e[r]===t)return r;return-1},p.lastIndexOf=function(e,t,n){if(null==e)return-1;var r=e.length;for("number"==typeof n&&(r=0>n?r+n+1:Math.min(r,n+1));--r>=0;)if(e[r]===t)return r;return-1},p.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=n||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r),s=0;r>s;s++,e+=n)i[s]=e;return i};var y=function(){};p.bind=function(e,t){var n,r;if(h&&e.bind===h)return h.apply(e,o.call(arguments,1));if(!p.isFunction(e))throw new TypeError("Bind must be called on a function");return n=o.call(arguments,2),r=function(){if(this instanceof r){y.prototype=e.prototype;var i=new y;y.prototype=null;var s=e.apply(i,n.concat(o.call(arguments)));return p.isObject(s)?s:i}return e.apply(t,n.concat(o.call(arguments)))}},p.partial=function(e){var t=o.call(arguments,1);return function(){for(var n=0,r=t.slice(),i=0,s=r.length;s>i;i++)r[i]===p&&(r[i]=arguments[n++]);for(;n<arguments.length;)r.push(arguments[n++]);return e.apply(this,r)}},p.bindAll=function(e){var t,n,r=arguments.length;if(1>=r)throw new Error("bindAll must be passed function names");for(t=1;r>t;t++)n=arguments[t],e[n]=p.bind(e[n],e);return e},p.memoize=function(e,t){var n=function(r){var i=n.cache,s=t?t.apply(this,arguments):r;return p.has(i,s)||(i[s]=e.apply(this,arguments)),i[s]};return n.cache={},n},p.delay=function(e,t){var n=o.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},p.defer=function(e){return p.delay.apply(p,[e,1].concat(o.call(arguments,1)))},p.throttle=function(e,t,n){var r,i,s,o=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:p.now(),o=null,s=e.apply(r,i),o||(r=i=null)};return function(){var f=p.now();u||n.leading!==!1||(u=f);var l=t-(f-u);return r=this,i=arguments,0>=l||l>t?(clearTimeout(o),o=null,u=f,s=e.apply(r,i),o||(r=i=null)):o||n.trailing===!1||(o=setTimeout(a,l)),s}},p.debounce=function(e,t,n){var r,i,s,o,u,a=function(){var f=p.now()-o;t>f&&f>0?r=setTimeout(a,t-f):(r=null,n||(u=e.apply(s,i),r||(s=i=null)))};return function(){s=this,i=arguments,o=p.now();var f=n&&!r;return r||(r=setTimeout(a,t)),f&&(u=e.apply(s,i),s=i=null),u}},p.wrap=function(e,t){return p.partial(t,e)},p.negate=function(e){return function(){return!e.apply(this,arguments)}},p.compose=function(){var e=arguments,t=e.length-1;return function(){for(var n=t,r=e[t].apply(this,arguments);n--;)r=e[n].call(this,r);return r}},p.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},p.before=function(e,t){var n;return function(){return--e>0?n=t.apply(this,arguments):t=null,n}},p.once=p.partial(p.before,2),p.keys=function(e){if(!p.isObject(e))return[];if(c)return c(e);var t=[];for(var n in e)p.has(e,n)&&t.push(n);return t},p.values=function(e){for(var t=p.keys(e),n=t.length,r=Array(n),i=0;n>i;i++)r[i]=e[t[i]];return r},p.pairs=function(e){for(var t=p.keys(e),n=t.length,r=Array(n),i=0;n>i;i++)r[i]=[t[i],e[t[i]]];return r},p.invert=function(e){for(var t={},n=p.keys(e),r=0,i=n.length;i>r;r++)t[e[n[r]]]=n[r];return t},p.functions=p.methods=function(e){var t=[];for(var n in e)p.isFunction(e[n])&&t.push(n);return t.sort()},p.extend=function(e){if(!p.isObject(e))return e;for(var t,n,r=1,i=arguments.length;i>r;r++){t=arguments[r];for(n in t)f.call(t,n)&&(e[n]=t[n])}return e},p.pick=function(e,t,n){var r,i={};if(null==e)return i;if(p.isFunction(t)){t=d(t,n);for(r in e){var s=e[r];t(s,r,e)&&(i[r]=s)}}else{var a=u.apply([],o.call(arguments,1));e=new Object(e);for(var f=0,l=a.length;l>f;f++)r=a[f],r in e&&(i[r]=e[r])}return i},p.omit=function(e,t,n){if(p.isFunction(t))t=p.negate(t);else{var r=p.map(u.apply([],o.call(arguments,1)),String);t=function(e,t){return!p.contains(r,t)}}return p.pick(e,t,n)},p.defaults=function(e){if(!p.isObject(e))return e;for(var t=1,n=arguments.length;n>t;t++){var r=arguments[t];for(var i in r)e[i]===void 0&&(e[i]=r[i])}return e},p.clone=function(e){return p.isObject(e)?p.isArray(e)?e.slice():p.extend({},e):e},p.tap=function(e,t){return t(e),e};var b=function(e,t,n,r){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return e===t;e instanceof p&&(e=e._wrapped),t instanceof p&&(t=t._wrapped);var i=a.call(e);if(i!==a.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!==+e?+t!==+t:0===+e?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}if("object"!=typeof e||"object"!=typeof t)return!1;for(var s=n.length;s--;)if(n[s]===e)return r[s]===t;var o=e.constructor,u=t.constructor;if(o!==u&&"constructor"in e&&"constructor"in t&&!(p.isFunction(o)&&o instanceof o&&p.isFunction(u)&&u instanceof u))return!1;n.push(e),r.push(t);var f,l;if("[object Array]"===i){if(f=e.length,l=f===t.length)for(;f--&&(l=b(e[f],t[f],n,r)););}else{var c,h=p.keys(e);if(f=h.length,l=p.keys(t).length===f)for(;f--&&(c=h[f],l=p.has(t,c)&&b(e[c],t[c],n,r)););}return n.pop(),r.pop(),l};p.isEqual=function(e,t){return b(e,t,[],[])},p.isEmpty=function(e){if(null==e)return!0;if(p.isArray(e)||p.isString(e)||p.isArguments(e))return 0===e.length;for(var t in e)if(p.has(e,t))return!1;return!0},p.isElement=function(e){return!!e&&1===e.nodeType},p.isArray=l||function(e){return"[object Array]"===a.call(e)},p.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},p.each(["Arguments","Function","String","Number","Date","RegExp"],function(e){p["is"+e]=function(t){return a.call(t)==="[object "+e+"]"}}),p.isArguments(arguments)||(p.isArguments=function(e){return p.has(e,"callee")}),"function"!=typeof /./&&(p.isFunction=function(e){return"function"==typeof e||!1}),p.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},p.isNaN=function(e){return p.isNumber(e)&&e!==+e},p.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"===a.call(e)},p.isNull=function(e){return null===e},p.isUndefined=function(e){return e===void 0},p.has=function(e,t){return null!=e&&f.call(e,t)},p.noConflict=function(){return e._=t,this},p.identity=function(e){return e},p.constant=function(e){return function(){return e}},p.noop=function(){},p.property=function(e){return function(t){return t[e]}},p.matches=function(e){var t=p.pairs(e),n=t.length;return function(e){if(null==e)return!n;e=new Object(e);for(var r=0;n>r;r++){var i=t[r],s=i[0];if(i[1]!==e[s]||!(s in e))return!1}return!0}},p.times=function(e,t,n){var r=Array(Math.max(0,e));t=d(t,n,1);for(var i=0;e>i;i++)r[i]=t(i);return r},p.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},p.now=Date.now||function(){return(new Date).getTime()};var w={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},E=p.invert(w),S=function(e){var t=function(t){return e[t]},n="(?:"+p.keys(e).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(e){return e=null==e?"":""+e,r.test(e)?e.replace(i,t):e}};p.escape=S(w),p.unescape=S(E),p.result=function(e,t){if(null==e)return void 0;var n=e[t];return p.isFunction(n)?e[t]():n};var x=0;p.uniqueId=function(e){var t=++x+"";return e?e+t:t},p.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var T=/(.)^/,N={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},C=/\\|'|\r|\n|\u2028|\u2029/g,k=function(e){return"\\"+N[e]};p.template=function(e,t,n){!t&&n&&(t=n),t=p.defaults({},t,p.templateSettings);var r=RegExp([(t.escape||T).source,(t.interpolate||T).source,(t.evaluate||T).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(r,function(t,n,r,o,u){return s+=e.slice(i,u).replace(C,k),i=u+t.length,n?s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?s+="'+\n((__t=("+r+"))==null?'':__t)+\n'":o&&(s+="';\n"+o+"\n__p+='"),t}),s+="';\n",t.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=new Function(t.variable||"obj","_",s)}catch(u){throw u.source=s,u}var a=function(e){return o.call(this,e,p)},f=t.variable||"obj";return a.source="function("+f+"){\n"+s+"}",a},p.chain=function(e){var t=p(e);return t._chain=!0,t};var L=function(e){return this._chain?p(e).chain():e};p.mixin=function(e){p.each(p.functions(e),function(t){var n=p[t]=e[t];p.prototype[t]=function(){var e=[this._wrapped];return s.apply(e,arguments),L.call(this,n.apply(p,e))}})},p.mixin(p),p.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=n[e];p.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0],L.call(this,n)}}),p.each(["concat","join","slice"],function(e){var t=n[e];p.prototype[e]=function(){return L.call(this,t.apply(this._wrapped,arguments))}}),p.prototype.value=function(){return this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return p})}).call(this);function _isInBetween(e,t,n){return Math.abs(e-t)<1e-6||Math.abs(t-n)<1e-6?!1:e<t&&t<n||n<t&&t<e}var Geometry={pointInTriangle:function(e,t,n,r){var i=new Vector3(e.x,e.y,1),s=new Vector3(t.x,t.y,1),o=new Vector3(n.x,n.y,1),u=new Vector3(r.x,r.y,1),a=o.subtract(i),f=s.subtract(i),l=u.subtract(i),c=a.dot(a),h=a.dot(f),p=a.dot(l),d=f.dot(f),v=f.dot(l),m=1/(c*d-h*h),g=(d*p-h*v)*m;if(g<0||g>1)return!1;var y=(c*v-h*p)*m;return y<0||y>1?!1:g+y<=1},isIntersect:function(e,t){var n=e.endPoint.y-e.startPoint.y,r=e.startPoint.x-e.endPoint.x,i=n*e.startPoint.x+r*e.startPoint.y,s=t.endPoint.y-t.startPoint.y,o=t.startPoint.x-t.endPoint.x,u=s*t.startPoint.x+o*t.startPoint.y,a=n*o-s*r;if(a==0)return!1;var f=(o*i-r*u)/a,l=(n*u-s*i)/a;return(_isInBetween(e.startPoint.x,f,e.endPoint.x)||_isInBetween(e.startPoint.y,l,e.endPoint.y))&&(_isInBetween(t.startPoint.x,f,t.endPoint.x)||_isInBetween(t.startPoint.y,l,t.endPoint.y))?!0:!1},distance:function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}};var UpgradeConfig={};function hex_sha1(e){return rstr2hex(rstr_sha1(str2rstr_utf8(e)))}function b64_sha1(e){return rstr2b64(rstr_sha1(str2rstr_utf8(e)))}function any_sha1(e,t){return rstr2any(rstr_sha1(str2rstr_utf8(e)),t)}function hex_hmac_sha1(e,t){return rstr2hex(rstr_hmac_sha1(str2rstr_utf8(e),str2rstr_utf8(t)))}function b64_hmac_sha1(e,t){return rstr2b64(rstr_hmac_sha1(str2rstr_utf8(e),str2rstr_utf8(t)))}function any_hmac_sha1(e,t,n){return rstr2any(rstr_hmac_sha1(str2rstr_utf8(e),str2rstr_utf8(t)),n)}function sha1_vm_test(){return hex_sha1("abc").toLowerCase()=="a9993e364706816aba3e25717850c26c9cd0d89d"}function rstr_sha1(e){return binb2rstr(binb_sha1(rstr2binb(e),e.length*8))}function rstr_hmac_sha1(e,t){var n=rstr2binb(e);n.length>16&&(n=binb_sha1(n,e.length*8));var r=Array(16),i=Array(16);for(var s=0;s<16;s++)r[s]=n[s]^909522486,i[s]=n[s]^1549556828;var o=binb_sha1(r.concat(rstr2binb(t)),512+t.length*8);return binb2rstr(binb_sha1(i.concat(o),672))}function rstr2hex(e){try{hexcase}catch(t){hexcase=0}var n=hexcase?"0123456789ABCDEF":"0123456789abcdef",r="",i;for(var s=0;s<e.length;s++)i=e.charCodeAt(s),r+=n.charAt(i>>>4&15)+n.charAt(i&15);return r}function rstr2b64(e){try{b64pad}catch(t){b64pad=""}var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="",i=e.length;for(var s=0;s<i;s+=3){var o=e.charCodeAt(s)<<16|(s+1<i?e.charCodeAt(s+1)<<8:0)|(s+2<i?e.charCodeAt(s+2):0);for(var u=0;u<4;u++)s*8+u*6>e.length*8?r+=b64pad:r+=n.charAt(o>>>6*(3-u)&63)}return r}function rstr2any(e,t){var n=t.length,r=Array(),i,s,o,u,a=Array(Math.ceil(e.length/2));for(i=0;i<a.length;i++)a[i]=e.charCodeAt(i*2)<<8|e.charCodeAt(i*2+1);while(a.length>0){u=Array(),o=0;for(i=0;i<a.length;i++){o=(o<<16)+a[i],s=Math.floor(o/n),o-=s*n;if(u.length>0||s>0)u[u.length]=s}r[r.length]=o,a=u}var f="";for(i=r.length-1;i>=0;i--)f+=t.charAt(r[i]);var l=Math.ceil(e.length*8/(Math.log(t.length)/Math.log(2)));for(i=f.length;i<l;i++)f=t[0]+f;return f}function str2rstr_utf8(e){var t="",n=-1,r,i;while(++n<e.length)r=e.charCodeAt(n),i=n+1<e.length?e.charCodeAt(n+1):0,55296<=r&&r<=56319&&56320<=i&&i<=57343&&(r=65536+((r&1023)<<10)+(i&1023),n++),r<=127?t+=String.fromCharCode(r):r<=2047?t+=String.fromCharCode(192|r>>>6&31,128|r&63):r<=65535?t+=String.fromCharCode(224|r>>>12&15,128|r>>>6&63,128|r&63):r<=2097151&&(t+=String.fromCharCode(240|r>>>18&7,128|r>>>12&63,128|r>>>6&63,128|r&63));return t}function str2rstr_utf16le(e){var t="";for(var n=0;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)&255,e.charCodeAt(n)>>>8&255);return t}function str2rstr_utf16be(e){var t="";for(var n=0;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)>>>8&255,e.charCodeAt(n)&255);return t}function rstr2binb(e){var t=Array(e.length>>2);for(var n=0;n<t.length;n++)t[n]=0;for(var n=0;n<e.length*8;n+=8)t[n>>5]|=(e.charCodeAt(n/8)&255)<<24-n%32;return t}function binb2rstr(e){var t="";for(var n=0;n<e.length*32;n+=8)t+=String.fromCharCode(e[n>>5]>>>24-n%32&255);return t}function binb_sha1(e,t){e[t>>5]|=128<<24-t%32,e[(t+64>>9<<4)+15]=t;var n=Array(80),r=1732584193,i=-271733879,s=-1732584194,o=271733878,u=-1009589776;for(var a=0;a<e.length;a+=16){var f=r,l=i,c=s,h=o,p=u;for(var d=0;d<80;d++){d<16?n[d]=e[a+d]:n[d]=bit_rol(n[d-3]^n[d-8]^n[d-14]^n[d-16],1);var v=safe_add(safe_add(bit_rol(r,5),sha1_ft(d,i,s,o)),safe_add(safe_add(u,n[d]),sha1_kt(d)));u=o,o=s,s=bit_rol(i,30),i=r,r=v}r=safe_add(r,f),i=safe_add(i,l),s=safe_add(s,c),o=safe_add(o,h),u=safe_add(u,p)}return Array(r,i,s,o,u)}function sha1_ft(e,t,n,r){return e<20?t&n|~t&r:e<40?t^n^r:e<60?t&n|t&r|n&r:t^n^r}function sha1_kt(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function safe_add(e,t){var n=(e&65535)+(t&65535),r=(e>>16)+(t>>16)+(n>>16);return r<<16|n&65535}function bit_rol(e,t){return e<<t|e>>>32-t}var hexcase=0,b64pad="=";function sprintf(){var e=arguments[0],t=sprintf.cache;if(!t[e]||!t.hasOwnProperty(e))t[e]=sprintf.parse(e);return sprintf.format.call(null,t[e],arguments)}function get_type(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function str_repeat(e,t){return Array(t+1).join(e)}var re={not_string:/[^s]/,number:/[dief]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fiosuxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[\+\-]/};sprintf.format=function(e,t){var n=1,r=e.length,i="",s,o=[],u,a,f,l,c,h,p=!0,d="";for(u=0;u<r;u++){i=get_type(e[u]);if(i==="string")o[o.length]=e[u];else if(i==="array"){f=e[u];if(f[2]){s=t[n];for(a=0;a<f[2].length;a++){if(!s.hasOwnProperty(f[2][a]))throw new Error(sprintf("[sprintf] property '%s' does not exist",f[2][a]));s=s[f[2][a]]}}else f[1]?s=t[f[1]]:s=t[n++];get_type(s)=="function"&&(s=s());if(re.not_string.test(f[8])&&get_type(s)!="number"&&isNaN(s))throw new TypeError(sprintf("[sprintf] expecting number but found %s",get_type(s)));re.number.test(f[8])&&(p=s>=0);switch(f[8]){case"b":s=s.toString(2);break;case"c":s=String.fromCharCode(s);break;case"d":case"i":s=parseInt(s,10);break;case"e":s=f[7]?s.toExponential(f[7]):s.toExponential();break;case"f":s=f[7]?parseFloat(s).toFixed(f[7]):parseFloat(s);break;case"o":s=s.toString(8);break;case"s":s=(s=String(s))&&f[7]?s.substring(0,f[7]):s;break;case"u":s>>>=0;break;case"x":s=s.toString(16);break;case"X":s=s.toString(16).toUpperCase()}re.number.test(f[8])&&(!p||f[3])?(d=p?"+":"-",s=s.toString().replace(re.sign,"")):d="",c=f[4]?f[4]==="0"?"0":f[4].charAt(1):" ",h=f[6]-(d+s).length,l=f[6]?h>0?str_repeat(c,h):"":"",o[o.length]=f[5]?d+s+l:c==="0"?d+l+s:l+d+s}}return o.join("")},sprintf.cache={},sprintf.parse=function(e){var t=e,n=[],r=[],i=0;while(t){if((n=re.text.exec(t))!==null)r[r.length]=n[0];else if((n=re.modulo.exec(t))!==null)r[r.length]="%";else{if((n=re.placeholder.exec(t))===null)throw new SyntaxError("[sprintf] unexpected placeholder");if(n[2]){i|=1;var s=[],o=n[2],u=[];if((u=re.key.exec(o))===null)throw new SyntaxError("[sprintf] failed to parse named argument key");s[s.length]=u[1];while((o=o.substring(u[0].length))!=="")if((u=re.key_access.exec(o))!==null)s[s.length]=u[1];else{if((u=re.index_access.exec(o))===null)throw new SyntaxError("[sprintf] failed to parse named argument key");s[s.length]=u[1]}n[2]=s}else i|=2;if(i===3)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");r[r.length]=n}t=t.substring(n[0].length)}return r};var vsprintf=function(e,t,n){return n=(t||[]).slice(0),n.splice(0,0,e),sprintf.apply(null,n)};var ULS=UMLocalStorage={key:"ironman_v1",set:function(e,t){var n="";switch(e.type){case"json":n=JSON.stringify(t);break;case"string":n=t;break;case"number":n=t.toString()}var r=_.random(1e5,999999),i=hex_md5(this.key+"|"+SH.STUDIO_NAME+"|"+n+"|"+r);cc.sys.localStorage.setItem(e.name,n+"|"+i+"|"+r)},get:function(e){var t=cc.sys.localStorage.getItem(e.name);if(!t&&t==null)return null;var n=t.split("|"),r=n[0];if(!n[1]||!n[2])return null;if(hex_md5(this.key+"|"+SH.STUDIO_NAME+"|"+r+"|"+n[2])!=n[1])return null;t=r;var i=null;if(t!=null&&typeof t!="undefined"&&t!=""&&t!=[])switch(e.type){case"json":i=JSON.parse(t);break;case"string":i=t;break;case"number":i=Number(t)}return i}};var Audio={currentMusic:"",forever:!1,enabled:!0,isPlayingMusic:!1,playEffect:function(e,t){return this.enabled?cc.audioEngine.playEffect(e,t):null},playMusic:function(e,t){this.stopMusic(),this.enabled&&(this.currentMusic!=e||!this.isPlayingMusic)&&(this.isPlayingMusic=!0,cc.audioEngine.playMusic(e,t)),this.forever=t,this.currentMusic=e},stopMusic:function(){this.enabled&&(cc.audioEngine.stopMusic(),this.isPlayingMusic=!1),this.currentMusic=""},stopAllEffects:function(){this.enabled&&cc.audioEngine.stopAllEffects()},stopEffect:function(e){cc.audioEngine.stopEffect(e)},soundEnable:function(){var e=ULS.get(USK.GameInfo);e.SoundEnable=UM.Sound.Enable,ULS.set(USK.GameInfo,e),this.enabled=!0,this.currentMusic&&this.forever&&this.playMusic(this.currentMusic,this.forever)},soundDisable:function(){var e=ULS.get(USK.GameInfo);e.SoundEnable=UM.Sound.Disable,ULS.set(USK.GameInfo,e),this.enabled=!1,this.isPlayingMusic=!1,cc.audioEngine.stopMusic(),cc.audioEngine.stopAllEffects()},setMusicVolume:function(e){cc.audioEngine.setMusicVolume(e);var t=ULS.get(USK.GameInfo);t.musicVolume=e,ULS.set(USK.GameInfo,t)},getMusicVolume:function(){return cc.audioEngine.getMusicVolume()},setEffectsVolume:function(e){cc.audioEngine.setEffectsVolume(e);var t=ULS.get(USK.GameInfo);t.soundVolume=e,ULS.set(USK.GameInfo,t)},getEffectsVolume:function(){return cc.audioEngine.getEffectsVolume()}};var JoyStick=function(e){var e=e,t=1,n=1,r=null,i=function(t){var n=e.x<t.x&&t.x<e.x+e.width,r=e.y<t.y&&t.y<e.y+e.height;return n&&r};this.setBasePos=function(e){return i(e)&&(r={x:e.x,y:e.y}),r},this.getBasePos=function(){return r},this.getDpos=function(e){var i=null;if(!r)return;var s=e.x-r.x,o=e.y-r.y,u=Math.sqrt(Math.pow(s,2)+Math.pow(o,2)),a=Math.atan2(o,s)*180/Math.PI;return a<0?a+=360:"",u>0&&(i={stick:{vX:n*s/u,vY:n*o/u},target:{vX:t*s/u,vY:t*o/u},angle:a}),i},this.resetPos=function(){r=null},this.setTargetV=function(e){t=e},this.setStickV=function(e){n=e}};var JoyStickPannel=cc.Sprite.extend({stick:null,buttomStick:null,radius:null,speed:3,xVelocity:0,yVelocity:0,ctor:function(e,t){this._super(),this.buttomStick=new cc.Sprite(e),this.addChild(this.buttomStick),this.stick=new cc.Sprite(t),this.addChild(this.stick),this._initScale()},_initScale:function(){this.buttomStick.scale=.4,this.stick.scale=.5,this.stick.setOpacity(100),this.buttomStick.setOpacity(100),this.radius=(this.buttomStick.width*.6-this.stick.width*.5)/2},isTouchesBegan:function(){this.buttomStick.scale=.5,this.stick.scale=.6,this.stick.setOpacity(255),this.buttomStick.setOpacity(255)},isTouchesEnded:function(){this._initScale()},setStickPos:function(e){this.stick.x=e.x-this.x,this.stick.y=e.y-this.y},move:function(e){var t=Math.sqrt(Math.pow(this.stick.getPositionX(),2)+Math.pow(this.stick.getPositionY(),2));t>this.radius&&(this.stick.x=this.stick.x*this.radius/t,this.stick.y=this.stick.y*this.radius/t)},update:function(){this.move()}});var Button=cc.Sprite.extend({ctor:function(e,t){this._super("#"+e);var n=new cc.Sprite("#skills_bg.png");n.setAnchorPoint(cc.p(0,0)),n.x=-10,n.y=-10,this.addChild(n,-1),this._normal=e,this._press=t,this.onTouchBegan=null,this.onTouchEnded=null;var r=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouchBeganEvent.bind(this),onTouchEnded:this.onTouchEndedEvent.bind(this)});cc.eventManager.addListener(r,this)},onTouchBeganEvent:function(e,t){var n=!1;if(this.isVisible()){var r=e.getLocation(),i={};i.x=r.x,i.y=r.y,this.hitTest(i)&&(n=!0)}return n?(this._press?this.setSpriteFrame(this._press):this.setScale(.9),this.onTouchBegan&&this.onTouchBegan(e,t),!0):!1},onTouchEndedEvent:function(e,t){this._press?this.setSpriteFrame(this._normal):this.setScale(1),this.onTouchEnded&&this.onTouchEnded(e,t)},hitTest:function(e){var t=cc.rect(0,0,this.width,this.height);return cc.rectContainsPoint(t,this.convertToNodeSpace(e))}});var ButtonNoEdg=cc.Sprite.extend({ctor:function(e,t){this._super("#"+e),this._normal=e,this._press=t,this.onTouchBegan=null,this.onTouchEnded=null;var n=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouchBeganEvent.bind(this),onTouchEnded:this.onTouchEndedEvent.bind(this)});cc.eventManager.addListener(n,this)},onTouchBeganEvent:function(e,t){var n=!1;if(this.isVisible()){var r=e.getLocation(),i={};i.x=r.x,i.y=r.y,this.hitTest(i)&&(n=!0)}return n?(this._press?this.setSpriteFrame(this._press):this.setScale(.9),this.onTouchBegan&&this.onTouchBegan(e,t),!0):!1},onTouchEndedEvent:function(e,t){this._press?this.setSpriteFrame(this._normal):this.setScale(1),this.onTouchEnded&&this.onTouchEnded(e,t)},hitTest:function(e){var t=cc.rect(0,0,this.width,this.height);return cc.rectContainsPoint(t,this.convertToNodeSpace(e))}});var Bullet=cc.Class.extend({ctor:function(){this.active=!1,this._id=uuid(),this._step=0,this._viewObj=null},initData:function(e){this._parent=e},reuse:function(e,t){this._weaponPosition=t,this.active=!0,this._viewObj.visible=!0,this.initData(e),Bullet.bulletsOnStage.push(this)},unuse:function(){this.active=!1,this._viewObj.unscheduleAllCallbacks(),this._viewObj.stopAllActions(),this._viewObj.retain(),this._viewObj.removeFromParent(!0),this._explodeObj&&this._explodeObj.removeFromParent(!0);for(var e=0,t=Bullet.bulletsOnStage.length;e<t;++e){var n=Bullet.bulletsOnStage[e];if(n.getId()==this._id){Bullet.bulletsOnStage.splice(e,1);break}}},release:function(){this._viewObj.release()},getId:function(){return this._id},update:function(){if(!this.active)return;++this._step,this._checkOverBorder()},_checkOverBorder:function(){var e=this._viewObj.x,t=this._viewObj.y;if(e<0||e>cc.winSize.width||t<0||t>cc.winSize.height)this._destroy(),this._disable()},_destroy:function(){},_disable:function(){this.unuse()}});Bullet.bulletsOnStage=[],Bullet.create=function(e,t,n){switch(t){case SH.Bullet.Characters.Rifle:return BulletRifle.create(e);case SH.Bullet.Characters.Rocket:return BulletRocket.create(e,n);case SH.Bullet.Characters.Electric:return BulletElectric.create(e);case SH.Bullet.Monster.Rifle:return BulletMonsterRifle.create(e)}},Bullet.updateAll=function(e){for(var t=0;t<Bullet.bulletsOnStage.length;t++){var n=Bullet.bulletsOnStage[t];n.update(e)}},Bullet.preset=function(e,t){switch(t){case SH.Bullet.Characters.Rifle:BulletRifle.preset(e);break;case SH.Bullet.Characters.Rocket:BulletRocket.preset(e);break;case SH.Bullet.Characters.Electric:BulletElectric.preset(e);break;case SH.Bullet.Monster.Rifle:BulletMonsterRifle.preset(e)}},Bullet.resetAll=function(){for(var e=0;e<Bullet.bulletsOnStage.length;++e){var t=Bullet.bulletsOnStage[e];(function(e){e.unuse(),e.release()})(t)}Bullet.bulletsOnStage=[]};var Creature=cc.Class.extend({ctor:function(e,t){this._isStriking=!1,this._whiteShader=null,this._whiteRecoeverShader=null,this.initShader()},initShader:function(){cc.sys.isNative?(this._whiteShader=new cc.GLProgram(GameRes.shaders.whiteHit.vsh_noMVP,GameRes.shaders.whiteHit.fsh),this._whiteShader.link(),this._whiteShader.updateUniforms(),this._whiteShader.retain(),this._whiteRecoeverShader=new cc.GLProgram(GameRes.shaders.whiteHitRecover.vsh_noMVP,GameRes.shaders.whiteHitRecover.fsh),this._whiteRecoeverShader.link(),this._whiteRecoeverShader.updateUniforms(),this._whiteRecoeverShader.retain()):(this._whiteShader=new cc.GLProgram(GameRes.shaders.whiteHit.vsh,GameRes.shaders.whiteHit.fsh),this._whiteShader.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),this._whiteShader.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS),this._whiteShader.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),this._whiteShader.link(),this._whiteShader.updateUniforms(),this._whiteShader.use(),this._whiteRecoeverShader=new cc.GLProgram(GameRes.shaders.whiteHitRecover.vsh,GameRes.shaders.whiteHitRecover.fsh),this._whiteRecoeverShader.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),this._whiteRecoeverShader.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS),this._whiteRecoeverShader.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),this._whiteRecoeverShader.link(),this._whiteRecoeverShader.updateUniforms(),this._whiteRecoeverShader.use())},strike:function(e){if(!this._isStriking){this._isStriking=!0;var t=cc.callFunc(function(){this._whiteHit()},this),n=cc.callFunc(function(){this._whiteHitRecover()},this);this._viewObj.runAction(cc.sequence(t,cc.delayTime(.05),n,cc.delayTime(.05),t,cc.delayTime(.05),n,cc.delayTime(.05),cc.callFunc(function(){this._isStriking=!1,e&&e()},this)))}},_whiteHit:function(){if(cc.sys.isNative){var e=cc.GLProgramState.getOrCreateWithGLProgram(this._whiteShader);this._viewObj.setGLProgramState(e)}else this._viewObj.shaderProgram=this._whiteShader},_whiteHitRecover:function(){if(cc.sys.isNative){var e=cc.GLProgramState.getOrCreateWithGLProgram(this._whiteRecoeverShader);this._viewObj.setGLProgramState(e)}else this._viewObj.shaderProgram=this._whiteRecoeverShader},resetAll:function(){},_hitStatusRecover:function(){this._isStriking=!1,this._whiteHitRecover()}});var Character=Creature.extend({isDead:null,ctor:function(e){this._super(),this._step=0,this._parent=e,this._viewObj=null,this._speed=0,this._weapon=null,this._velocity={x:0,y:0},this._TotalHP=100,this._HP=this._TotalHP,this._moveBuffer={x:0,y:0},this._shadowObjs=[],this._isShowBegin=!1,this.isDead=!1},init:function(){this._HP=CharacterConfig[this.name].HP,this._speed=CharacterConfig[this.name].speed;for(var e=0;e<20;++e){var t=cc.Sprite.create(CharacterConfig[this.name].res);t.visible=!1,t.setOpacity(255),this._parent.addChild(t),this._shadowObjs.push(t)}},addListeners:function(){cc.eventManager.addCustomListener(SC.CHARACTER_SET_WEAPON,_.bind(function(e){this._setWeapon(e.getUserData().weaponName)},this)),cc.eventManager.addCustomListener(SC.CHARACTER_RESET_WEAPON,_.bind(function(e){this._resetWeapon()},this))},setVelocity:function(e){this._velocity.x=this._speed*e.vX,this._velocity.y=this._speed*e.vY},setPosition:function(e){this._viewObj.setPosition(e)},getPosition:function(){return this._viewObj.getPosition()},getScaleX:function(){return this._viewObj.scaleX},doHitByMonster:function(e,t){if(this._isShiel)return;if(this.isDead)return;this._HP-=e,this.strike(),cc.eventManager.dispatchCustomEvent(SC.HP_UPDATE,{HP:Math.max(this._HP,0),TotalHP:this._TotalHP}),this._HP<=0&&this._doDie()},_doDie:function(){this.isDead=!0,cc.eventManager.dispatchCustomEvent(SC.IRONMAN_DIE),this._viewObj.runAction(cc.spawn(cc.moveBy(.5,cc.p(cc.randomMinus1To1()*50,-100)),cc.rotateBy(.5,220)).repeat(5))},getCollideBoundingBox:function(){return this._viewObj.getBoundingBox()},getRotation:function(){return this._viewObj.getRotation()},showShoot:function(){},update:function(){++this._step,this._move(),this._changeDirection(),this._weapon&&this._weapon.update()},_move:function(){if(this.isDead)return;if(this._velocity.x!=0||this._velocity.y!=0){this._viewObj.x+=this._velocity.x,this._viewObj.y+=this._velocity.y;for(var e=0,t=this._shadowObjs.length;e<t;++e)if(!this._shadowObjs[e].visible){shadow=this._shadowObjs[e],shadow.visible=!0;break}shadow||(shadow=cc.Sprite.create(CharacterConfig[this.name].res),this.parent.addChild(shadow),this._shadowObjs.push(shadow)),shadow.setOpacity(50),shadow.setScaleX(this._viewObj.scaleX),shadow.setScaleY(this._viewObj.scaleY),shadow.setPosition(this._viewObj.getPosition()),shadow.setRotation(this._viewObj.getRotation()),shadow.runAction(cc.sequence(cc.fadeOut(.05),cc.callFunc(function(e){return function(){e.visible=!1}}(shadow),this)))}else this._step%10==0&&(this._moveBuffer={x:(Math.random()>.5?-1:1)*Math.random()/5,y:(Math.random()>.5?-1:1)*Math.random()/5}),this._viewObj.x+=this._moveBuffer.x,this._viewObj.y+=this._moveBuffer.y;this._viewObj.x=Math.min(cc.winSize.width,Math.max(0,this._viewObj.x)),this._viewObj.y=Math.min(cc.winSize.height,Math.max(0,this._viewObj.y))},_setWeapon:function(e){this._weapon=Weapon.create(e,this._parent),this._weaponFire.setPosition(CharacterConfig[this.name].weaponFire.buffer),e=="Rocket"&&this._weaponFire.setPosition(cc.p(CharacterConfig[this.name].weaponFire.buffer.x+25,CharacterConfig[this.name].weaponFire.buffer.y+40)),this._weapon.addDisplayWeapon(this._viewObj)},_resetWeapon:function(){this._weapon&&this._weapon.removeDisplayWeapon(),this._weapon=null},_changeDirection:function(){var e=this._velocity.x,t=this._velocity.y,n=this._viewObj.getRotation();e==0?t>0?n=0:t<0&&(n=180):t==0?e>0?n=90:e<0&&(n=270):(n=Math.atan(t/e)*180/Math.PI,this._viewObj.setScaleX((e<0?-1:1)*Math.abs(this._viewObj.scaleX)),n=-n),this._viewObj.setRotation(n)}});Character.current=null,Character.create=function(e,t){switch(e){case SH.Character.Ironman:Character.current=new Ironman(t)}return Character.current};var MonsterStatus={MOVE_TO_TARGET:"moveToTarget",BEFORE_ATTACK:"beforeAttack",ATTACK:"attack",BACK_ATTACK:"backAttack"},Monsters=Creature.extend({_DamageByType:null,ctor:function(e,t){this._super(e,t),this.active=!1,this._framesData=t.framesData,this._viewObj=new cc.Sprite("#"+this._framesData.Move[0]),this._viewObj.setName("monster"),this._viewObj.visible=!1,this._id=uuid(),this._monsterId="",this._level=0,this._hasEvent=!1,this._parent=null,this._isDead=!1,this._hurtable=!1,this._movable=!0,this._target=null,this._currentStatus="",this._hurtStep=0,this._properties={dps:0,currentHP:0},this._speed=0,this._scale=1,this._score=0,this._stepX=0,this._stepY=0,this._targetPos=null,this.initData(e,t)},initData:function(e,t){this._isDead=!1,this._hurtable=!0,this._isStriking=!1,t.bornPlace&&this._viewObj.setPosition(cc.p(t.bornPlace.x,t.bornPlace.y))},addListeners:function(){},start:function(){},doMoveToTarget:function(){},getMonsterId:function(){return this._id},getPosition:function(){return this._viewObj.getPosition()},getDamageBoundingBox:function(){return this._viewObj.getBoundingBox()},getCollideBoundingBox:function(){return this._viewObj.getBoundingBox()},isDie:function(){this._properties.currentHP<=0&&this.doDie()},doDie:function(){this._isDead=!0,this._hurtable=!1},disable:function(){if(!this.active)return;this._viewObj.visible=!1,this.active=!1,this._weapon&&this._weapon.removeDisplayWeapon(),this.unuse()},unuse:function(){this._viewObj.stopAllActions(),this._viewObj.visible=!1,this._viewObj.retain(),this._viewObj.removeFromParent(!0),this._hitStatusRecover(),this.active=!1,this._freeze&&this._viewObj.removeChild(this._freeze),this._freeze=null;for(var e=0,t=Monsters.monstersOnStage.length;e<t;++e){var n=Monsters.monstersOnStage[e];if(n.getMonsterId()==this._id){Monsters.monstersOnStage.splice(e,1);break}}},_move:function(){if(this._target.isDead)return;if(this._target._isShiel){var e=cc.pDistance(cc.p(this.getPosition().x,this.getPosition().y),cc.p(this._target.getPosition().x,this._target.getPosition().y));if(e<70){this._viewObj.x-=this._stepX*15,this._viewObj.y-=this._stepY*15;return}if(e<85){this._viewObj.x+=this._target._velocity.x*this._target._speed,this._viewObj.y+=this._target._velocity.y*this._target._speed;return}}},freezeRelease:function(){if(!this._isFreezing)return;this._viewObj.runAction(cc.sequence(cc.callFunc(function(){this._viewObj.setColor(cc.color(255,255,255,255)),this._viewObj.setBlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA)},this),cc.delayTime(.2),cc.callFunc(function(){this._viewObj.setColor(cc.color(118,233,241,255)),this._viewObj.setBlendFunc(cc.SRC_ALPHA,cc.ONE)},this),cc.delayTime(.2),cc.callFunc(function(){this._viewObj.setColor(cc.color(255,255,255,255)),this._viewObj.setBlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA)},this),cc.delayTime(.2),cc.callFunc(function(){this._viewObj.setColor(cc.color(118,233,241,255)),this._viewObj.setBlendFunc(cc.SRC_ALPHA,cc.ONE)},this),cc.delayTime(.2),cc.callFunc(function(){this._viewObj.setColor(cc.color(255,255,255,255)),this._viewObj.setBlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA)},this),cc.delayTime(.2),cc.callFunc(function(){this._viewObj.setColor(cc.color(118,233,241,255)),this._viewObj.setBlendFunc(cc.SRC_ALPHA,cc.ONE)},this),cc.delayTime(.2),cc.callFunc(function(){this._viewObj.setColor(cc.color(255,255,255,255)),this._viewObj.setBlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA)},this),cc.delayTime(.2),cc.callFunc(function(){this._viewObj.setColor(cc.color(118,233,241,255)),this._viewObj.setBlendFunc(cc.SRC_ALPHA,cc.ONE)},this),cc.delayTime(.2),cc.callFunc(function(){this._viewObj.setColor(cc.color(255,255,255,255)),this._viewObj.setBlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA)},this),cc.delayTime(.1),cc.callFunc(function(){this._viewObj.setColor(cc.color(118,233,241,255)),this._viewObj.setBlendFunc(cc.SRC_ALPHA,cc.ONE)},this),cc.delayTime(.1),cc.callFunc(function(){this._viewObj.setColor(cc.color(118,233,241,255)),this._viewObj.setBlendFunc(cc.SRC_ALPHA,cc.ONE)},this),cc.callFunc(function(){this._viewObj.setColor(cc.color(255,255,255,255)),this._viewObj.setBlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA)},this),cc.delayTime(.1),cc.callFunc(function(){this._viewObj.setColor(cc.color(118,233,241,255)),this._viewObj.setBlendFunc(cc.SRC_ALPHA,cc.ONE)},this),cc.delayTime(.1),cc.callFunc(function(){this._viewObj.setColor(cc.color(118,233,241,255)),this._viewObj.setBlendFunc(cc.SRC_ALPHA,cc.ONE)},this),cc.callFunc(function(){this._isFreezing=!1,this._viewObj.setColor(cc.color(255,255,255,255)),this._viewObj.setBlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA)},this)))},freezeMonstersByBomb:function(){this._viewObj.setColor(cc.color(118,233,241,255)),this._viewObj.setBlendFunc(cc.SRC_ALPHA,cc.ONE),this._isFreezing=!0;var e=new MonsterFreezeEffect(this);e.start(),this._freeze=e},hitMonstersByBomb:function(e){this._properties.currentHP=0,this._DamageByType=e},hitMonstersByBullet:function(e){if(!this._hurtable||this._isDead)return;this.strike(),this._properties.currentHP-=e.dps,this._DamageByType=e.name,e.name=="BulletRocket"?(this._viewObj.x-=this._stepX*8*4*cc.random0To1(),this._viewObj.y-=this._stepY*8*4*cc.random0To1()):(this._viewObj.x-=this._stepX*5,this._viewObj.y-=this._stepY*5)},_doExplode:function(){var e=new MonsterExplodeEffect;e.x=this._viewObj.x,e.y=this._viewObj.y,this._parent.addChild(e),e.play(this._DamageByType),this.disable()},reuse:function(e,t){this.active=!0,this.initData(e,t),Monsters.monstersOnStage.push(this),this._hasEvent||(this._hasEvent=!0,this.addListeners())},release:function(){this._hasEvent=!1,this._viewObj.release()},update:function(e){}});Monsters.resetAll=function(){for(var e=0;e<Monsters.monstersOnStage.length;++e){var t=Monsters.monstersOnStage[e];(function(e){e.unuse(),e.release()})(t)}Monsters.monstersOnStage=[]},Monsters.monstersOnStage=[],Monsters.updateAll=function(e){for(var t=0;t<Monsters.monstersOnStage.length;t++){var n=Monsters.monstersOnStage[t];n.update(e)}},Monsters.create=function(e,t){var n=SH.MONSTERSNAME,r=null;switch(t.name){case n.Alpha:r=MonsterAlpha.create(e,t);break;case n.Beta:r=MonsterBeta.create(e,t);break;case n.Charlie:r=MonsterCharlie.create(e,t)}return r},Monsters.preset=function(e){MonsterAlpha.preset(e,MonsterConfig.Alpha),MonsterBeta.preset(e,MonsterConfig.Beta),MonsterCharlie.preset(e,MonsterConfig.Charlie)};var Weapon=cc.Class.extend({ctor:function(e){this._parent=e,this._step=-1},update:function(){++this._step},_shoot:function(){Character.current.showShoot()},addDisplayWeapon:function(e){},removeDisplayWeapon:function(){this._weaponFire&&this._weaponFire.removeFromParent(!0)}});Weapon.create=function(e,t){switch(e){case SH.Weapon.Characters.Rifle:return new WeaponRifle(t);case SH.Weapon.Characters.Rocket:return new WeaponRocket(t);case SH.Weapon.Characters.Electric:return new WeaponElectric(t);case SH.Weapon.Monster.Rifle:return new WeaponMonsterRifle(t)}};var BulletRifle=Bullet.extend({ctor:function(){this._super(),this._viewObj=cc.Sprite.create(WeaponConfig.Rifle.bullets.res),this._velocity={x:0,y:0},this.name="BulletRifle"},initData:function(e){this._super(e),this.dps=5,this._viewObj.setPosition(Character.current.getPosition());var t=WeaponConfig.Rifle.bullets.speed,n=Character.current.getScaleX(),r=Character.current.getRotation()+90;this._viewObj.setRotation(r+(n>0?0:180)),this._velocity={x:t*Math.sin(r*Math.PI/180)*(Math.abs(n)/n),y:t*Math.cos(r*Math.PI/180)*(Math.abs(n)/n)},this._parent.addChild(this._viewObj)},_move:function(){this._viewObj.x+=this._velocity.x,this._viewObj.y+=this._velocity.y},_characterCollide:function(){var e=Monsters.monstersOnStage;for(var t=0,n=e.length;t<n;++t){var r=e[t];if(r.active&&cc.rectIntersectsRect(this._viewObj.getBoundingBox(),r.getCollideBoundingBox())){r.hitMonstersByBullet(this),this._disable();return}}},update:function(){this._super(),this._move(),this._characterCollide()}});BulletRifle.bullets=[],BulletRifle.preset=function(e){for(var t=0;t<WeaponConfig.Rifle.bullets.presetAmount;++t){var n=new BulletRifle(e);n.unuse(),BulletRifle.bullets.push(n)}},BulletRifle.create=function(e,t){var n=null;for(var r=0,i=BulletRifle.bullets.length;r<i;++r){var s=BulletRifle.bullets[r];s.active||(n=s)}return n||(n=new BulletRifle),n.reuse(e),n};var Ironman=Character.extend({ctor:function(e){this._super(e),this.name=SH.Character.Ironman,this._viewObj=cc.Sprite.create(CharacterConfig[this.name].res),this._parent.addChild(this._viewObj,100),this._weaponFire=cc.Sprite.create("#"+CharacterConfig[this.name].weaponFire.frames[0]),this._weaponFire.setRotation(90),this._weaponFire.setScale(CharacterConfig[this.name].weaponFire.scale),this._weaponFire.setPosition(CharacterConfig[this.name].weaponFire.buffer),this._weaponFire.visible=!1,this._viewObj.addChild(this._weaponFire),this.init(),this.addListeners(),this._getAnimation("Ironman","weaponFire")},init:function(){this._super(),this._showBegin()},addListeners:function(){this._super(),cc.eventManager.addCustomListener(SC.CHARACTER_SHIEL,_.bind(function(e){this._doShiel()},this))},showShoot:function(){},update:function(){this._super()},_doShiel:function(){var e=new Shield(this);e.start(),this._isShiel=!0},_changeDirection:function(){this._automaticAiming()},_automaticAiming:function(){if(this.isDead)return;var e=this._getClosestMonster();if(e){var t=e.x-this._viewObj.x,n=e.y-this._viewObj.y,r=Math.atan2(n,t)*180/Math.PI;r<0?r+=360:"",this._viewObj.setRotation(-r),-r<=-90&&-r>=-270?this._viewObj.setScaleY(-this._viewObj.getScaleX()):this._viewObj.setScaleY(this._viewObj.getScaleX())}},_getClosestMonster:function(){var e=null,t=this._parent.getAllMosterInBattleLayer(),n=999999;for(var r=0,i=t.length;r<i;r++){var s=t[r],o=cc.pDistance(cc.p(t[r].x,t[r].y),cc.p(this._viewObj.x,this._viewObj.y));o<n&&(n=o,e=s)}return e&&(e.minl=n),e},_showBegin:function(){this._isShowBegin=!0,this._viewObj.setScale(.1),this._viewObj.setPosition(cc.p(cc.winSize.width/2,cc.winSize.height/3)),this._viewObj.runAction(cc.scaleTo(.5,CharacterConfig[this.name].scale)),this._viewObj.runAction(cc.sequence(cc.moveTo(.5,cc.p(cc.winSize.width/2,cc.winSize.height/2)),cc.callFunc(function(){this._isShowBegin=!1,cc.eventManager.dispatchCustomEvent(SC.GAME_START)},this)))},_getAnimation:function(e,t){var n=cc.animationCache,r=cc.spriteFrameCache,i=n.getAnimation(e+t);if(i)return cc.animate(i);var s=[];for(var o=0,u=CharacterConfig[this.name][t].frames.length;o<u;++o){var a=CharacterConfig[this.name][t].frames[o];s.push(cc.spriteFrameCache.getSpriteFrame(a))}var f=new cc.Animation(s,CharacterConfig[this.name][t].aniRate);return f.setRestoreOriginalFrame(!0),n.addAnimation(f,e+t),cc.animate(f)},_setWeapon:function(e){this._super(e),this._weaponFire.visible=!0,this._weaponFire.runAction(cc.sequence(this._getAnimation("Ironman","weaponFire")).repeatForever())},_resetWeapon:function(){this._super(),this._weaponFire.visible=!1,this._weaponFire.stopAllActions()}});var MonsterAlpha=Monsters.extend({ctor:function(e,t){this._super(e,t)},initData:function(e,t){this._parent=e,this._monsterId=t.monsterId;if(!this._monsterId)return;var n=MonsterConfig.Alpha.values[this._monsterId];this._properties.currentHP=n.HP+(this._level-1)*n.levelEnhance.HP,this._properties.dps=n.dps+(this._level-1)*n.levelEnhance.dps,this._speed=n.speed+(this._level-1)*n.levelEnhance.speed,this._score=n.score+(this._level-1)*n.levelEnhance.score,this._scale=n.scale,this._parent.addChild(this._viewObj),this._viewObj.setScale(this._scale),this._viewObj.setPosition(t.bornPlace),this._viewObj.visible=!0,this._hurtable=!0,this._movable=!0,this._target=Character.current,this._super(e,t)},start:function(){this.doMoveToTarget()},doMoveToTarget:function(){this._super(),this._currentStatus=MonsterStatus.MOVE_TO_TARGET},getAnimation:function(e){var t=cc.animationCache,n=cc.spriteFrameCache,r=t.getAnimation(e);if(r)return cc.animate(r);var i=[],s=0;switch(e){case MonsterStatus.MOVE_TO_TARGET:break;case MonsterStatus.ATTACK:var o=MonsterConfig.Alpha.framesData,u=o.Attack;s=1/(u.length*o.speed);for(var a=0,f=u.length;a<f;a++){var l=n.getSpriteFrame(u[a]);i.push(l)}}var c=new cc.Animation(i,s);return cc.animationCache.addAnimation(c,e),cc.animate(c)},_move:function(){this._super();if(this._target.isDead)return;this._currentStatus==MonsterStatus.ATTACK?(this._viewObj.x+=(this._stepX+cc.randomMinus1To1())*.3,this._viewObj.y+=(this._stepY+cc.randomMinus1To1())*.3):(this._viewObj.x+=this._stepX,this._viewObj.y+=this._stepY)},_direction:function(){this._viewObj&&this._stepX>=0?this._viewObj.setFlippedX(!1):this._viewObj.setFlippedX(!0)},_doAttack:function(){if(this._currentStatus==MonsterStatus.ATTACK)return;var e=Character.current;e.doHitByMonster(this._properties.dps,this),cc.eventManager.dispatchCustomEvent(SC.MONSTER_HIT_CHARACTER),this._currentStatus=MonsterStatus.ATTACK;var t=this.getAnimation(MonsterStatus.ATTACK);this._viewObj.runAction(cc.sequence(t,cc.callFunc(function(){this.doMoveToTarget()}.bind(this))))},doDie:function(){this._isDead||(this._isDead=!0,this._hurtable=!1,this._doExplode())},_checkCollideTarget:function(){cc.rectIntersectsRect(this.getDamageBoundingBox(),this._target.getCollideBoundingBox())&&this._doAttack()},update:function(e){this.isDie();if(this._isFreezing)return;switch(this._currentStatus){case MonsterStatus.MOVE_TO_TARGET:if(this._movable&&!this._target.isDead){var t=this._target.getPosition(),n=cc.pNormalize(cc.pSub(t,this.getPosition()));this._stepX=n.x*this._speed,this._stepY=n.y*this._speed}break;case MonsterStatus.ATTACK:}this._checkCollideTarget(),this._move(),this._direction()}});MonsterAlpha.monsters=[],MonsterAlpha.preset=function(e,t){for(var n=0;n<MonsterConfig.Alpha.presetAmount;n++){var r=new MonsterAlpha(e,t);r.unuse(),MonsterAlpha.monsters.push(r)}},MonsterAlpha.create=function(e,t,n){var r=null;for(var i=0,s=MonsterAlpha.monsters.length;i<s;++i){var o=MonsterAlpha.monsters[i];o.active||(r=o)}return r||(r=new MonsterAlpha(e,t)),r.reuse(e,t),r};var MonsterBeta=Monsters.extend({_ATTACK_COOLDOWN:1.5,_ATTACKBEFORE_COOLDOWN:.5,ctor:function(e,t){this._super(e,t)},initData:function(e,t){this._parent=e,this._monsterId=t.monsterId;if(!this._monsterId)return;var n=MonsterConfig.Beta.values[this._monsterId];this._properties.currentHP=n.HP+(this._level-1)*n.levelEnhance.HP,this._properties.dps=n.dps+(this._level-1)*n.levelEnhance.dps,this._speed=n.speed+(this._level-1)*n.levelEnhance.speed,this._score=n.score+(this._level-1)*n.levelEnhance.score,this._scale=n.scale,this._viewObj.setScale(this._scale),this._parent.addChild(this._viewObj),this._viewObj.setPosition(t.bornPlace),this._viewObj.visible=!0,this._hurtable=!0,this._movable=!0,this._target=Character.current,this._attackCD=this._ATTACK_COOLDOWN,this._attackBeforeCD=this._ATTACKBEFORE_COOLDOWN,this._saveTargetPosition=null,this._backPosition=null,this._super(e,t)},start:function(){this.doMoveToTarget()},doMoveToTarget:function(){this._super(),this._currentStatus=MonsterStatus.MOVE_TO_TARGET,this._viewObj.setSpriteFrame(this._framesData.Move[0])},getAnimation:function(e){},_move:function(){this._super();if(this._target.isDead)return;if(this._currentStatus==MonsterStatus.ATTACK)return;if(this._currentStatus==MonsterStatus.BEFORE_ATTACK)return;if(this._currentStatus==MonsterStatus.BACK_ATTACK)return;var e=cc.pDistance(cc.p(this.getPosition().x,this.getPosition().y),cc.p(this._target.getPosition().x,this._target.getPosition().y));e>=220?(this._viewObj.x+=this._stepX,this._viewObj.y+=this._stepY):(this._viewObj.x+=cc.randomMinus1To1()*.6,this._viewObj.y+=cc.randomMinus1To1()*.6)},_direction:function(){var e=this._target.getPosition(),t=Math.atan2(e.y-this.getPosition().y,e.x-this.getPosition().x)*180/Math.PI;t<0&&(t+=360),this._viewObj.setRotation(-t),-t<=-90&&-t>=-270?this._viewObj.setFlippedY(!0):this._viewObj.setFlippedY(!1)},_doAttackBefore:function(e){if(!this._backPosition&&!this._saveTargetPosition){this._viewObj.setSpriteFrame(this._framesData.Attack[0]),this._backPosition=this.getPosition(),this._saveTargetPosition=this._target.getPosition();var t=cc.pDistance(cc.p(this._backPosition.x,this._backPosition.y),cc.p(this._saveTargetPosition.x,this._saveTargetPosition.y));if(t<=120){var n=cc.director.getWinSize();this._backPosition=cc.p(cc.random0To1()*n.width,cc.random0To1()*n.height)}}this._stepX=cc.randomMinus1To1(),this._stepY=cc.randomMinus1To1(),this._viewObj.x+=this._stepX,this._viewObj.y+=this._stepY,this._attackBeforeCD-=e,this._attackBeforeCD<=0&&this._doAttack()},_doAttack:function(){if(this._currentStatus==MonsterStatus.ATTACK)return;this._currentStatus=MonsterStatus.ATTACK,this._viewObj.runAction(cc.sequence(cc.moveTo(.3,cc.p(this._saveTargetPosition.x,this._saveTargetPosition.y)),cc.callFunc(function(){this._doAttackBack()},this)))},_doAttackBack:function(){if(this._currentStatus==MonsterStatus.BACK_ATTACK)return;this._currentStatus=MonsterStatus.BACK_ATTACK,this._backPosition&&this._viewObj.runAction(cc.sequence(cc.moveTo(.2,cc.p(this._backPosition.x,this._backPosition.y)),cc.callFunc(function(){this._attackCD=this._ATTACK_COOLDOWN,this.doMoveToTarget()},this)))},doDie:function(){this._isDead||(this._isDead=!0,this._hurtable=!1,this._doExplode())},_checkCollideTarget:function(){if(cc.rectIntersectsRect(this.getDamageBoundingBox(),this._target.getCollideBoundingBox())){var e=Character.current;e.doHitByMonster(this._properties.dps,this),cc.eventManager.dispatchCustomEvent(SC.MONSTER_HIT_CHARACTER)}},update:function(e){this.isDie();if(this._isFreezing)return;switch(this._currentStatus){case MonsterStatus.MOVE_TO_TARGET:if(this._movable&&!this._target.isDead){var t=this._target.getPosition(),n=cc.pNormalize(cc.pSub(t,this.getPosition()));this._stepX=n.x*this._speed,this._stepY=n.y*this._speed;var r=cc.pDistance(cc.p(this._viewObj.x,this._viewObj.y),cc.p(t.x,t.y));this._attackCD-=e,this._attackCD<=0&&r<=300&&!this._target._isShiel&&(this._attackBeforeCD=this._ATTACKBEFORE_COOLDOWN,this._backPosition=null,this._saveTargetPosition=null,this._currentStatus=MonsterStatus.BEFORE_ATTACK)}break;case MonsterStatus.ATTACK:this._doAttack();break;case MonsterStatus.BACK_ATTACK:this._doAttackBack();break;case MonsterStatus.BEFORE_ATTACK:this._doAttackBefore(e)}this._checkCollideTarget(),this._move(),this._direction()}});MonsterBeta.monsters=[],MonsterBeta.preset=function(e,t){for(var n=0;n<MonsterConfig.Beta.presetAmount;n++){var r=new MonsterBeta(e,t);r.unuse(),MonsterBeta.monsters.push(r)}},MonsterBeta.create=function(e,t,n){var r=null;for(var i=0,s=MonsterBeta.monsters.length;i<s;++i){var o=MonsterBeta.monsters[i];o.active||(r=o)}return r||(r=new MonsterBeta(e,t)),r.reuse(e,t),r};var MonsterCharlie=Monsters.extend({_weapon:null,ctor:function(e,t){this._super(e,t)},initData:function(e,t){this._parent=e,this._monsterId=t.monsterId;if(!this._monsterId)return;var n=MonsterConfig.Charlie.values[this._monsterId];this._properties.currentHP=n.HP+(this._level-1)*n.levelEnhance.HP,this._properties.dps=n.dps+(this._level-1)*n.levelEnhance.dps,this._speed=n.speed+(this._level-1)*n.levelEnhance.speed,this._score=n.score+(this._level-1)*n.levelEnhance.score,this._scale=n.scale,this._viewObj.setScale(this._scale),this._parent.addChild(this._viewObj,1),this._viewObj.setPosition(t.bornPlace),this._viewObj.visible=!0,this._hurtable=!0,this._movable=!0,this._target=Character.current,this._initWeapon(),this._super(e,t)},start:function(){this.doMoveToTarget()},_initWeapon:function(){this._weapon=Weapon.create(SH.Weapon.Monster.Rifle,this._parent),this._weapon.setUser(this._viewObj)},hitMonstersByBullet:function(e){this._super(e)},doMoveToTarget:function(){this._super(),this._currentStatus=MonsterStatus.MOVE_TO_TARGET},getAnimation:function(e){},_shoot:function(e){if(this._target.isDead)return;this._weapon&&this._weapon.update(e)},_move:function(){this._super();if(this._currentStatus==MonsterStatus.ATTACK)return;var e=cc.pDistance(cc.p(this.getPosition().x,this.getPosition().y),cc.p(this._target.getPosition().x,this._target.getPosition().y));e>=220?(this._viewObj.x+=this._stepX+cc.randomMinus1To1()*.3,this._viewObj.y+=this._stepY+cc.randomMinus1To1()*.3):(this._viewObj.x+=cc.randomMinus1To1()*.3,this._viewObj.y+=cc.randomMinus1To1()*.3)},_direction:function(){var e=this._target.getPosition(),t=Math.atan2(e.y-this.getPosition().y,e.x-this.getPosition().x)*180/Math.PI;t<0&&(t+=360),this._viewObj.setRotation(-t),-t<=-90&&-t>=-270?this._viewObj.setFlippedY(!0):this._viewObj.setFlippedY(!1)},doDie:function(){this._isDead||(this._isDead=!0,this._hurtable=!1,this._doExplode())},_checkCollideTarget:function(){cc.rectIntersectsRect(this.getDamageBoundingBox(),this._target.getCollideBoundingBox())},update:function(e){this.isDie();if(this._isFreezing)return;switch(this._currentStatus){case MonsterStatus.MOVE_TO_TARGET:if(this._movable&&!this._target.isDead){var t=this._target.getPosition(),n=cc.pNormalize(cc.pSub(t,this.getPosition()));this._stepX=n.x*this._speed,this._stepY=n.y*this._speed}break;case MonsterStatus.ATTACK:}this._checkCollideTarget(),this._move(),this._direction(),this._shoot(e)}});MonsterCharlie.monsters=[],MonsterCharlie.preset=function(e,t){for(var n=0;n<MonsterConfig.Charlie.presetAmount;n++){var r=new MonsterCharlie(e,t);r.unuse(),MonsterCharlie.monsters.push(r)}},MonsterCharlie.create=function(e,t,n){var r=null;for(var i=0,s=MonsterCharlie.monsters.length;i<s;++i){var o=MonsterCharlie.monsters[i];o.active||(r=o)}return r||(r=new MonsterCharlie(e,t),r.unuse()),r.reuse(e,t),r};var MonsterExplodeEffect=cc.Sprite.extend({ctor:function(){this._super("#weaponEffect1.png"),this.scale=1},getAnimation:function(e){var t=[],n="",r=cc.animationCache.getAnimation(e);if(r)return cc.animate(r);switch(e){case"Bomb":for(var i=0;i<=6;i++){n="BombEffect00"+i+".png";var s=cc.spriteFrameCache.getSpriteFrame(n);t.push(s)}break;case"BulletRifle":for(var i=1;i<=9;i++){n="weaponEffect"+i+".png";var s=cc.spriteFrameCache.getSpriteFrame(n);t.push(s)}break;case"BulletRocket":for(var i=1;i<=9;i++){n="weaponEffect"+i+".png";var s=cc.spriteFrameCache.getSpriteFrame(n);t.push(s)}break;case"BulletElectric":for(var i=1;i<=9;i++){n="weaponEffect"+i+".png";var s=cc.spriteFrameCache.getSpriteFrame(n);t.push(s)}}var r=new cc.Animation(t,1/8);return cc.animationCache.addAnimation(r,e),cc.animate(r)},play:function(e){var t=this.getAnimation(e);this.runAction(cc.sequence(t,cc.callFunc(this.destroy,this)))},destroy:function(){this.visible=!1,this.active=!1,this.removeFromParent(!0)}});var MonsterFreezeEffect=cc.Sprite.extend({_target:null,ctor:function(e){this._super("#freeze000.png"),this._target=e,this.active=!0},start:function(){this._target._viewObj.addChild(this),this.setScale(cc.random0To1()+4.2),this.setPosition(cc.p(this._target._viewObj.width/2,this._target._viewObj.height/2)),this.scheduleOnce(function(){var e=this.getAnimation("Freeze");this.runAction(cc.sequence(e,cc.callFunc(function(){this._destroy()},this)))}.bind(this),6)},getAnimation:function(e){var t=[],n="",r=cc.animationCache.getAnimation(e);if(r)return cc.animate(r);switch(e){case"Freeze":for(var i=1;i<=7;i++){n="freeze_0000"+i+".png";var s=cc.spriteFrameCache.getSpriteFrame(n);t.push(s)}}var r=new cc.Animation(t,1/9);return cc.animationCache.addAnimation(r,e),cc.animate(r)},_destroy:function(){this._target._viewObj.removeChild(this)}});var WeaponRifle=Weapon.extend({ctor:function(e){this._super(e)},update:function(){this._super(),this._step%WeaponConfig.Rifle.shootStep==0&&this._shoot()},_shoot:function(){this._super(),Bullet.create(this._parent,SH.Bullet.Characters.Rifle)}});var WeaponRocket=Weapon.extend({_viewObj:null,ctor:function(e){this._super(e),this._initView()},_initView:function(){},addDisplayWeapon:function(e){this._viewObj||(this._viewObj=new cc.Sprite(WeaponConfig.Rocket.res),this._viewObj.setScale(e.getScale()),this._viewObj.x=105,this._viewObj.y=100,this._viewObj.setAnchorPoint(cc.p(0,0)),this._viewObj.setRotation(-90),this._user=e,this._user.addChild(this._viewObj,-1))},update:function(){this._super(),this._step%WeaponConfig.Rocket.shootStep==0&&this._shoot()},_shoot:function(){this._super(),this._viewObj&&this._viewObj.runAction(cc.sequence(cc.rotateTo(.1,0),cc.callFunc(function(){var e=this._viewObj.convertToWorldSpace(this._viewObj.getPosition());Bullet.create(this._parent,SH.Bullet.Characters.Rocket,e)},this)))},removeDisplayWeapon:function(){this._viewObj&&this._viewObj.runAction(cc.sequence(cc.rotateTo(.1,-90),cc.callFunc(function(){this._user.removeChild(this._viewObj)},this)))}});var WeaponElectric=Weapon.extend({ctor:function(e){this._super(e)},update:function(){this._super(),this._step%WeaponConfig.Electric.shootStep==0&&this._shoot()},_shoot:function(){this._super(),Bullet.create(this._parent,SH.Bullet.Characters.Electric)}});var WeaponMonsterRifle=Weapon.extend({_user:null,ctor:function(e){this._super(e)},setUser:function(e){this._user=e,this._initWeaponFire()},update:function(){this._super(),this._step%WeaponConfig.MonsterRifle.shootStep==0&&(this._shoot(),this._weaponFire.visible=!0,this._weaponFire.runAction(cc.sequence(this._getAnimation("Ironman","weaponFire"),cc.callFunc(function(){this._weaponFire.visible=!1},this))))},_initWeaponFire:function(){this._weaponFire=cc.Sprite.create("#"+MonsterConfig.Charlie.weaponFire.frames[0]),this._weaponFire.setRotation(90),this._weaponFire.setScale(MonsterConfig.Charlie.weaponFire.scale),this._weaponFire.setPosition(MonsterConfig.Charlie.weaponFire.buffer),this._user.addChild(this._weaponFire)},_getAnimation:function(e,t){var n=cc.animationCache,r=cc.spriteFrameCache,i=n.getAnimation(e+t);if(i)return cc.animate(i);var s=[];for(var o=0,u=MonsterConfig.Charlie.weaponFire.frames.length;o<u;++o){var a=MonsterConfig.Charlie.weaponFire.frames[o];s.push(cc.spriteFrameCache.getSpriteFrame(a))}var f=new cc.Animation(s,CharacterConfig[this.name][t].aniRate);return f.setRestoreOriginalFrame(!0),n.addAnimation(f,e+t),cc.animate(f)},_shoot:function(){this._super();var e=Bullet.create(this._parent,SH.Bullet.Monster.Rifle);e.trigger(this._user)}});var Shield=cc.Sprite.extend({_target:null,ctor:function(e){this._super(GameRes.skills.png),this._target=e,this.active=!0},start:function(){this._target._viewObj.addChild(this),this.setScale(1.2),this.setPosition(cc.p(this._target._viewObj.width/2,this._target._viewObj.height/2)),this.runAction(cc.spawn(cc.sequence(cc.scaleTo(.2,1.22),cc.scaleTo(.2,1.2)),cc.sequence(cc.fadeTo(.2,250),cc.fadeTo(.2,180)),cc.rotateBy(.4,20)).repeatForever()),this.scheduleOnce(function(){this.stopAction(),this.runAction(cc.sequence(cc.sequence(cc.fadeTo(.2,30),cc.fadeTo(.1,200)).repeat(3),cc.callFunc(function(){this._destroy()},this)))}.bind(this),6)},_destroy:function(){this._target._isShiel=!1,this._target._viewObj.removeChild(this)},update:function(){}});var BulletRifle=Bullet.extend({ctor:function(){this._super(),this._viewObj=cc.Sprite.create(WeaponConfig.Rifle.bullets.res),this._velocity={x:0,y:0},this.name="BulletRifle"},initData:function(e){this._super(e),this.dps=5,this._viewObj.setPosition(Character.current.getPosition());var t=WeaponConfig.Rifle.bullets.speed,n=Character.current.getScaleX(),r=Character.current.getRotation()+90;this._viewObj.setRotation(r+(n>0?0:180)),this._velocity={x:t*Math.sin(r*Math.PI/180)*(Math.abs(n)/n),y:t*Math.cos(r*Math.PI/180)*(Math.abs(n)/n)},this._parent.addChild(this._viewObj)},_move:function(){this._viewObj.x+=this._velocity.x,this._viewObj.y+=this._velocity.y},_characterCollide:function(){var e=Monsters.monstersOnStage;for(var t=0,n=e.length;t<n;++t){var r=e[t];if(r.active&&cc.rectIntersectsRect(this._viewObj.getBoundingBox(),r.getCollideBoundingBox())){r.hitMonstersByBullet(this),this._disable();return}}},update:function(){this._super(),this._move(),this._characterCollide()}});BulletRifle.bullets=[],BulletRifle.preset=function(e){for(var t=0;t<WeaponConfig.Rifle.bullets.presetAmount;++t){var n=new BulletRifle(e);n.unuse(),BulletRifle.bullets.push(n)}},BulletRifle.create=function(e,t){var n=null;for(var r=0,i=BulletRifle.bullets.length;r<i;++r){var s=BulletRifle.bullets[r];s.active||(n=s)}return n||(n=new BulletRifle),n.reuse(e),n};var BulletRocket=Bullet.extend({ctor:function(){this._super(),this._viewObj=cc.Sprite.create(WeaponConfig.Rocket.bullets.res),this._velocity={x:0,y:0},this.name="BulletRocket"},initData:function(e){this._super(e),this.dps=30,this._viewObj.setPosition(this._weaponPosition);var t=WeaponConfig.Rocket.bullets.speed,n=Character.current.getScaleX(),r=Character.current.getRotation()+90;this._viewObj.setRotation(r+(n>0?-90:-270)),this._viewObj.setScale(n/2),this._velocity={x:t*Math.sin(r*Math.PI/180)*(Math.abs(n)/n),y:t*Math.cos(r*Math.PI/180)*(Math.abs(n)/n)},this._parent.addChild(this._viewObj),this._explodeObj=new cc.Sprite("#"+WeaponConfig.Rocket.bullets.explode.frames[0]),this._explodeObj.visible=!1,this._parent.addChild(this._explodeObj)},_characterCollide:function(){var e=Monsters.monstersOnStage;for(var t=0,n=e.length;t<n;++t){var r=e[t];r.active&&cc.rectIntersectsRect(this._viewObj.getBoundingBox(),r.getCollideBoundingBox())&&(r.hitMonstersByBullet(this),this._explode(),this._viewObj.visible=!1)}},_explode:function(){this._explodeObj.visible=!0;var e=cc.p(this._viewObj.getPosition().x,this._viewObj.getPosition().y);this._explodeObj.setPosition(e);var t=this._getAnimation("BulletRocketEffect");this._explodeObj.runAction(cc.sequence(t,cc.callFunc(function(){this._disable()},this)))},_getAnimation:function(e){var t=cc.animationCache,n=cc.spriteFrameCache,r=[],i=0,s=t.getAnimation(e);if(s)return cc.animate(s);switch(e){case"BulletRocketEffect":i=1/(WeaponConfig.Rocket.bullets.explode.frames.length*WeaponConfig.Rocket.bullets.explode.speed);for(var o=0,u=WeaponConfig.Rocket.bullets.explode.frames.length;o<u;o++){var a=cc.spriteFrameCache.getSpriteFrame(WeaponConfig.Rocket.bullets.explode.frames[o]);r.push(a)}}var f=new cc.Animation(r,i);return cc.animationCache.addAnimation(f,e),cc.animate(f)},_move:function(){this._viewObj.x+=this._velocity.x,this._viewObj.y+=this._velocity.y},update:function(){this._super(),this._move(),this._characterCollide()}});BulletRocket.bullets=[],BulletRocket.preset=function(e){for(var t=0;t<WeaponConfig.Rocket.bullets.presetAmount;++t){var n=new BulletRocket(e);n.unuse(),BulletRocket.bullets.push(n)}},BulletRocket.create=function(e,t,n){var r=null;for(var i=0,s=BulletRocket.bullets.length;i<s;++i){var o=BulletRocket.bullets[i];o.active||(r=o)}return r||(r=new BulletRocket),r.reuse(e,t),r};var BulletElectric=Bullet.extend({ctor:function(){this._super(),this._viewObj=cc.Sprite.create("#"+WeaponConfig.Electric.bullets.frames[0]),this.name="BulletElectric"},initData:function(e){this._super(e);var t=Character.current.getRotation()+90,n=Character.current.getScaleX(),r=WeaponConfig.Electric.bullets.speed,i=cc.p(Character.current.getPosition().x,Character.current.getPosition().y);this.dps=15,this._viewObj.setAnchorPoint(cc.p(.5,0)),this._viewObj.setPosition(i),this._viewObj.setRotation(t),this._viewObj.setScale(n/4),this._parent.addChild(this._viewObj),this._velocity={x:r*Math.sin(t*Math.PI/180)*(Math.abs(n)/n),y:r*Math.cos(t*Math.PI/180)*(Math.abs(n)/n)}},_move:function(){this._viewObj.x+=this._velocity.x,this._viewObj.y+=this._velocity.y},_characterCollide:function(){var e=Monsters.monstersOnStage;for(var t=0,n=e.length;t<n;++t){var r=e[t];r.active&&cc.rectIntersectsRect(this._viewObj.getBoundingBox(),r.getCollideBoundingBox())&&r.hitMonstersByBullet(this)}},update:function(){this._super(),this._move(),this._characterCollide()}});BulletElectric.bullets=[],BulletElectric.preset=function(e){for(var t=0;t<WeaponConfig.Electric.bullets.presetAmount;++t){var n=new BulletElectric(e);n.unuse(),BulletElectric.bullets.push(n)}},BulletElectric.create=function(e,t){var n=null;for(var r=0,i=BulletElectric.bullets.length;r<i;++r){var s=BulletElectric.bullets[r];s.active||(n=s)}return n||(n=new BulletElectric),n.reuse(e),n};var BulletMonsterRifle=Bullet.extend({ctor:function(){this._super(),this._viewObj=cc.Sprite.create(WeaponConfig.MonsterRifle.bullets.res),this._velocity={x:0,y:0}},initData:function(e){this._super(e)},_characterCollide:function(){var e=Character.current,t=e.getCollideBoundingBox(),n=this._viewObj.getBoundingBox();cc.rectIntersectsRect(n,t)&&(e.doHitByMonster(WeaponConfig.MonsterRifle.bullets.dps,this),cc.eventManager.dispatchCustomEvent(SC.MONSTER_HIT_CHARACTER),this._disable())},trigger:function(e){this._viewObj.setPosition(e.getPosition()),this._viewObj.setScale(WeaponConfig.MonsterRifle.bullets.scale);var t=WeaponConfig.MonsterRifle.bullets.speed,n=e.getScaleX(),r=e.isFlippedY();r;var i=e.getRotation()+90;this._viewObj.setRotation(i+(n>0?0:180)),this._velocity={x:t*Math.sin(i*Math.PI/180)*(Math.abs(n)/n),y:t*Math.cos(i*Math.PI/180)*(Math.abs(n)/n)},this._parent.addChild(this._viewObj)},_move:function(){this._viewObj.x+=this._velocity.x,this._viewObj.y+=this._velocity.y},update:function(){this._super(),this._move(),this._characterCollide()}});BulletMonsterRifle.bullets=[],BulletMonsterRifle.preset=function(e){for(var t=0;t<WeaponConfig.MonsterRifle.bullets.presetAmount;++t){var n=new BulletMonsterRifle(e);n.unuse(),BulletMonsterRifle.bullets.push(n)}},BulletMonsterRifle.create=function(e,t){var n=null;for(var r=0,i=BulletMonsterRifle.bullets.length;r<i;++r){var s=BulletMonsterRifle.bullets[r];s.active||(n=s)}return n||(n=new BulletMonsterRifle,n.unuse()),n.reuse(e),n};var g_gamelayer=null,GameScene=cc.Scene.extend({onEnterTransitionDidFinish:function(){this._super();var e=new GameLayer;this.addChild(e),this.layer=e,g_gamelayer=this.layer,cc.sys.dumpRoot(),cc.sys.garbageCollect()},onExitTransitionDidStart:function(){this.removeListeners(),this.layer.unscheduleUpdate(),Monsters.resetAll(),Bullet.resetAll()},removeListeners:function(){for(var e in SH.CUSTOMEVENTS)cc.eventManager.removeCustomListeners(SH.CUSTOMEVENTS[e])}}),GameLayer=cc.Layer.extend({ctor:function(){this._super(),this.bgLayer=null,this.battleLayer=null,this.dropItemLayer=null,this.controllLayer=null,this.gameUILayer=null,this.explosionMaskLayer=null,this.initBgLayer(),this.initBattleLayer(),this.initDropItemLayer(),this.initControllLayer(),this.initGameUIlayer(),this.initExplosionMaskLayer(),this.addListeners(),this.scheduleUpdate()},addListeners:function(){cc.eventManager.addCustomListener(SC.IRONMAN_DIE,_.bind(function(e){this.initGameOverLayer()},this))},initGameOverLayer:function(){var e=new GameOverLayer;this.addChild(e),this.gameOverLayer=e},initBgLayer:function(){var e=new BgLayer;this.addChild(e),this.bgLayer=e},initGameUIlayer:function(){var e=new GameUILayer;this.addChild(e),this.gameUILayer=e},initBattleLayer:function(){var e=new BattleLayer;this.addChild(e),this.battleLayer=e},initControllLayer:function(){var e=new ControllLayer;this.addChild(e),this.controllLayer=e},initDropItemLayer:function(){var e=new DropItemLayer;this.addChild(e),this.dropItemLayer=e},initExplosionMaskLayer:function(){var e=new ExplosionMaskLayer;this.addChild(e),this.explosionMaskLayer=e},update:function(e){this.bgLayer.update&&this.battleLayer.update(),this.battleLayer.update&&this.battleLayer.update(),this.dropItemLayer.update&&this.dropItemLayer.update(),this.controllLayer.update&&this.controllLayer.update(e),this.gameUILayer.update&&this.gameUILayer.update(),Monsters.updateAll(e)}});var GameLoadingScene=function(){return cc.Scene.extend({onEnterTransitionDidFinish:function(){this._super();var e=new GameLoadingLayer;this.addChild(e)}})}(),GameLoadingLayer=function(){return cc.Layer.extend({ctor:function(){this._super(),this._resourceIndex=0,this._finishIndex=0,this.init()},init:function(){this.playLoading()},initConfig:function(){for(var e in MonsterConfig){var t=MonsterConfig[e];for(var n in MonstersBusinessConfig)if(MonstersBusinessConfig[n].resId==t.resId){var r=MonstersBusinessConfig[n];t.values[n]=r}}},playLoading:function(){var e=0;this.schedule(_.bind(function(){e+=5},this),.05,7),this._resourceIndex=0,this._finishIndex=0;var t=this;cc.loader.loadJs(["src/common/config/businessConfig/BusinessConfigJsList.js"],function(){cc.loader.loadJs(BusinessConfigJsList,function(){t._resourceIndex=0,t._finishIndex=0,t.schedule(function(){t.loadResource()},.5,0)})})},loadResource:function(){var e=this,t=0;cc.loader.load(game_resources,function(e,t,n){},_.bind(function(){e.initConfig(),e.addPlist(),Monsters.preset(e),Bullet.preset(e,SH.Bullet.Characters.Rifle),Bullet.preset(e,SH.Bullet.Characters.Rocket),Bullet.preset(e,SH.Bullet.Characters.Electric),e.schedule(e.finishedLoading,.1,0)},this))},finishedLoading:function(){var e=new StarGameScene;cc.director.runScene(new cc.TransitionFade(.1,e))},addPlist:function(){for(var e=0,t=game_resources.length;e<t;e++)game_resources[e].indexOf(".png")>0?cc.textureCache.addImage(game_resources[e]):game_resources[e].indexOf(".plist")>0&&cc.spriteFrameCache.addSpriteFrames(game_resources[e])}})}();var MainLoadingScene=cc.Scene.extend({onEnterTransitionDidFinish:function(){this._super();var e=new MainLoadingLayer;this.addChild(e)}}),MainLoadingLayer=function(){var e=0,t=3;return cc.Layer.extend({ctor:function(){this._super(),this._loadingWidget=null,this._loadingBg=null,this._loadingBar=null,this._loadingIcon=null,this._resourceIndex=0,this._finishIndex=0,this.init()},init:function(){this.loadGameConfig()},playLoading:function(){if(!cc.sys.isNative){this.loadGameConfig();return}var n=jsb.fileUtils?jsb.fileUtils.getWritablePath():"./",r=new jsb.AssetsManager("res/project.manifest",n);r.retain();if(!r.getLocalManifest().isLoaded())this.loadGameConfig();else{var i=this,s=new jsb.EventListenerAssetsManager(r,function(n){switch(n.getEventCode()){case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:cc.log("No local manifest file found, skip assets update."),i.loadGameConfig();break;case jsb.EventAssetsManager.UPDATE_PROGRESSION:var s=n.getPercent();cc.log(s+"%");var o=n.getMessage();o&&cc.log(o);break;case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:cc.log("Fail to download manifest file, update skipped."),i.loadGameConfig();break;case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:cc.log("Fail to parse manifest file, update skipped."),i.loadGameConfig();break;case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:cc.log("ALREADY_UP_TO_DATE."),i.loadGameConfig();break;case jsb.EventAssetsManager.UPDATE_FINISHED:cc.log("Update finished."),i.loadGameConfig();break;case jsb.EventAssetsManager.UPDATE_FAILED:cc.log("Update failed. "+n.getMessage()),e++,e<t?r.downloadFailedAssets():(cc.log("Reach maximum fail count, exit update process"),e=0,i.loadGameConfig());break;case jsb.EventAssetsManager.ERROR_UPDATING:cc.log("Asset update error: "+n.getAssetId()+", "+n.getMessage()),i.loadGameConfig();break;case jsb.EventAssetsManager.ERROR_DECOMPRESS:cc.log(n.getMessage()),i.loadGameConfig();break;default:}});cc.eventManager.addListener(s,1),r.update()}},loadGameConfig:function(){var e=this,t=0;this.schedule(_.bind(function(){t+=5},this),.05,7),e.schedule(function(){e.schedule(e.loadResource)},.5,0)},loadResource:function(){if(!main_resources[this._resourceIndex])return;var e=this;cc.loader.load(main_resources[this._resourceIndex],function(e,t,n){},function(){e._finishIndex++,e._finishIndex>=main_resources.length&&(e.unschedule(e.loadResource),e.initConfig(),e.addPlist(),e.schedule(e.finishedLoading,.1,0))}),e._resourceIndex++},initConfig:function(){},addPlist:function(){for(var e=0,t=main_resources.length;e<t;e++)main_resources[e].indexOf(".png")>0?cc.textureCache.addImage(main_resources[e]):main_resources[e].indexOf(".plist")>0&&cc.spriteFrameCache.addSpriteFrames(main_resources[e])},finishedLoading:function(){cc.log("On Preload Resources");var e=new MainMenuScene;cc.director.runScene(new cc.TransitionFade(.1,e))}})}();var MainMenuScene=cc.Scene.extend({onEnterTransitionDidFinish:function(){this._super();var e=new MainMenuLayer;this.addChild(e)},onExitTransitionDidStart:function(){cc.eventManager.removeCustomListeners(cc.game.EVENT_HIDE),cc.eventManager.removeCustomListeners(cc.game.EVENT_SHOW)}}),MainMenuLayer=cc.Layer.extend({ctor:function(){this._super(),this.init(),this.addListeners()},init:function(){this.initImages(),this.initButtons()},initImages:function(){var e=cc.winSize,t=new cc.Sprite("#mainMenu_Bg.png");this.addChild(t),t.attr({x:e.width*.5,y:e.height*.5})},initButtons:function(){this.initSoundBt(),this.initStarGameBt()},initStarGameBt:function(){var e=cc.winSize,t=new ButtonNoEdg("mainMenu_startBt.png");t.attr({x:e.width*.55,y:e.height*.15}),this.addChild(t),t.onTouchBegan=function(e,t){cc.director.runScene(new cc.TransitionFade(.1,new GameLoadingScene))},t.onTouchEnded=function(e,t){cc.eventManager.dispatchCustomEvent(SC.CHARACTER_RESET_WEAPON)}},initSoundBt:function(){var e=cc.winSize,t=new ButtonNoEdg("mainMenu_soundBt.png");t.attr({x:e.width*.9,y:e.height*.15}),this.addChild(t)},addListeners:function(){cc.eventManager.addCustomListener(cc.game.EVENT_HIDE,_.bind(function(){cc.director.isPaused()||cc.director.pause()},this)),cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,_.bind(function(){cc.director.isPaused()&&cc.director.resume()},this))}});var StarGameScene=cc.Scene.extend({onEnterTransitionDidFinish:function(){this._super(),this.init()},init:function(){var e=new StarGameLayer;this.addChild(e)},onExitTransitionDidStart:function(){cc.eventManager.removeCustomListeners(cc.game.EVENT_HIDE),cc.eventManager.removeCustomListeners(cc.game.EVENT_SHOW)}}),StarGameLayer=cc.Layer.extend({ctor:function(){this._super(),this.init()},init:function(){this.initImages(),this._initStar(),this.initButtons()},initImages:function(){var e=cc.winSize,t=new cc.Sprite("#bg.png");this.addChild(t),t.attr({x:e.width*.5,y:e.height*.5})},_initStar:function(){var e=cc.winSize,t=new cc.Sprite("#starBg.png");this.addChild(t),t.attr({x:e.width*.21,y:e.height*.92,scaleY:.9});var n=new cc.Sprite("#star.png");this.addChild(n),n.attr({x:e.width*.07,y:e.height*.93});var r=ULS.get(USK.PlayInfo).score,i=new cc.LabelBMFont(r.toString(),MainRes.customFont.customBMFont_2_fnt);i.setScale(.9),i.setPosition(cc.p(n.x+85,n.y+5)),this.addChild(i)},initButtons:function(){this.initBackBt(),this.initBoxHomeBt(),this.initMusicBt(),this.initStarFightingBt(),this.initUserFilesBt()},initBackBt:function(){var e=cc.winSize,t=new ButtonNoEdg("backBt.png");t.attr({x:e.width*.1,y:e.height*.12}),this.addChild(t),t.onTouchBegan=function(e,t){cc.director.runScene(new cc.TransitionFade(.1,new MainMenuScene))},t.onTouchEnded=function(e,t){}},initMusicBt:function(){var e=cc.winSize,t=new ButtonNoEdg("musicBt.png");t.attr({x:e.width*.9,y:e.height*.12}),this.addChild(t)},initStarFightingBt:function(){var e=cc.winSize,t=new ButtonNoEdg("starFightingBt.png");t.attr({x:e.width*.75,y:e.height*.5}),this.addChild(t),t.onTouchBegan=function(e,t){cc.director.runScene(new cc.TransitionFade(.1,new GameScene))},t.onTouchEnded=function(e,t){}},initUserFilesBt:function(){var e=cc.winSize,t=new ButtonNoEdg("userFilesBt.png");t.attr({x:e.width*.25,y:e.height*.5}),this.addChild(t),t.onTouchBegan=function(e,t){cc.director.runScene(new cc.TransitionFade(.1,new UserFilesScene))},t.onTouchEnded=function(e,t){}},initBoxHomeBt:function(){var e=cc.winSize,t=new ButtonNoEdg("boxHomeBt.png");t.attr({x:e.width*.9,y:e.height*.85}),this.addChild(t);var n=new cc.Sprite("#boxRedPoint.png");this.addChild(n),n.attr({x:e.width*.93,y:e.height*.9})}});var UserFilesScene=cc.Scene.extend({onEnterTransitionDidFinish:function(){this._super(),this.init()},onExitTransitionDidStart:function(){cc.eventManager.removeCustomListeners(cc.game.EVENT_HIDE),cc.eventManager.removeCustomListeners(cc.game.EVENT_SHOW)},init:function(){var e=new UserfilesLayer;this.addChild(e)}}),UserfilesLayer=cc.Layer.extend({ctor:function(){this._super(),this.init()},init:function(){this.initImages(),this.initButtons(),this._initBulletRifle(),this._initBulletElectric(),this._initBulletRocket(),this._initBomb(),this._initFreeze(),this._initShield(),this._initStar()},_initBulletRifle:function(){var e=cc.winSize,t=new cc.Sprite("#bullet_1.png");this.addChild(t),t.attr({x:e.width*.11,y:e.height*.66});var n=ULS.get(USK.PlayInfo).rifle,r=new cc.LabelBMFont(n,MainRes.customFont.customBMFont_1_fnt);r.setScale(.9),r.setPosition(cc.p(t.x+50,t.y-11)),this.addChild(r)},_initBulletElectric:function(){var e=cc.winSize,t=new cc.Sprite("#bullet_2.png");this.addChild(t),t.attr({x:e.width*.11,y:e.height*.52});var n=ULS.get(USK.PlayInfo).electric,r=new cc.LabelBMFont(n,MainRes.customFont.customBMFont_1_fnt);r.setScale(.9),r.setPosition(cc.p(t.x+50,t.y-15)),this.addChild(r)},_initBulletRocket:function(){var e=cc.winSize,t=new cc.Sprite("#bullet_3.png");this.addChild(t),t.attr({x:e.width*.11,y:e.height*.36});var n=ULS.get(USK.PlayInfo).rifle,r=new cc.LabelBMFont(n,MainRes.customFont.customBMFont_1_fnt);r.setScale(.9),r.setPosition(cc.p(t.x+50,t.y-11)),this.addChild(r)},_initBomb:function(){var e=cc.winSize,t=new cc.Sprite("#skill_1.png");this.addChild(t),t.attr({x:e.width*.6,y:e.height*.66});var n=ULS.get(USK.PlayInfo).bombNum,r=new cc.LabelBMFont(n.toString(),MainRes.customFont.customBMFont_1_fnt);r.setScale(.9),r.setPosition(cc.p(t.x+60,t.y-11)),this.addChild(r)},_initFreeze:function(){var e=cc.winSize,t=new cc.Sprite("#skill_2.png");this.addChild(t),t.attr({x:e.width*.6,y:e.height*.52});var n=ULS.get(USK.PlayInfo).freezeNum,r=new cc.LabelBMFont(n.toString(),MainRes.customFont.customBMFont_1_fnt);r.setScale(.9),r.setPosition(cc.p(t.x+60,t.y-14)),this.addChild(r)},_initShield:function(){var e=cc.winSize,t=new cc.Sprite("#skill_3.png");this.addChild(t),t.attr({x:e.width*.6,y:e.height*.36});var n=ULS.get(USK.PlayInfo).shieldNum,r=new cc.LabelBMFont(n.toString(),MainRes.customFont.customBMFont_1_fnt);r.setScale(.9),r.setPosition(cc.p(t.x+60,t.y-11)),this.addChild(r)},_initStar:function(){var e=cc.winSize,t=new cc.Sprite("#starBg.png");this.addChild(t),t.attr({x:e.width*.21,y:e.height*.92,scaleY:.9});var n=new cc.Sprite("#star.png");this.addChild(n),n.attr({x:e.width*.07,y:e.height*.93});var r=ULS.get(USK.PlayInfo).score,i=new cc.LabelBMFont(r.toString(),MainRes.customFont.customBMFont_2_fnt);i.setScale(.9),i.setPosition(cc.p(n.x+90,n.y+5)),this.addChild(i)},initImages:function(){var e=cc.winSize,t=new cc.Sprite("#bg.png");this.addChild(t),t.attr({x:e.width*.5,y:e.height*.5});var n=new cc.Sprite("#bgContent_1.png");this.addChild(n),n.attr({x:e.width*.5,y:e.height*.5});var r=new cc.Sprite("#bgContent_2.png");this.addChild(r),r.attr({x:e.width*.25,y:e.height*.5});var i=new cc.Sprite("#bgContent_2.png");this.addChild(i),i.attr({x:e.width*.75,y:e.height*.5});var s=new cc.Sprite("#bulletTitle.png");this.addChild(s),s.attr({x:e.width*.25,y:e.height*.83});var o=new cc.Sprite("#skillTitle.png");this.addChild(o),o.attr({x:e.width*.75,y:e.height*.83});var u=new cc.Sprite("#bgContent_3.png");this.addChild(u),u.attr({x:e.width*.15,y:e.height*.65,scaleX:1.1,scaleY:1.1});var a=new cc.Sprite("#bgContent_3.png");this.addChild(a),a.attr({x:e.width*.15,y:e.height*.5,scaleX:1.1,scaleY:1.1});var f=new cc.Sprite("#bgContent_3.png");this.addChild(f),f.attr({x:e.width*.15,y:e.height*.35,scaleX:1.1,scaleY:1.1});var l=new cc.Sprite("#bgContent_3.png");this.addChild(l),l.attr({x:e.width*.65,y:e.height*.65,scaleX:1.1,scaleY:1.1});var c=new cc.Sprite("#bgContent_3.png");this.addChild(c),c.attr({x:e.width*.65,y:e.height*.5,scaleX:1.1,scaleY:1.1});var h=new cc.Sprite("#bgContent_3.png");this.addChild(h),h.attr({x:e.width*.65,y:e.height*.35,scaleX:1.1,scaleY:1.1});var p=new cc.Sprite("#boxRedPoint.png");this.addChild(p,1),p.attr({x:e.width*.93,y:e.height*.95})},initButtons:function(){this.initSkillPlusBt_1(),this.initSkillPlusBt_2(),this.initSkillPlusBt_3(),this.initBulletPlusBt_1(),this.initBulletPlusBt_2(),this.initBulletPlusBt_3(),this.initBoxHomeBt(),this.initBackBt()},initSkillPlusBt_1:function(){var e=cc.winSize,t=new ButtonNoEdg("plusBt.png");t.attr({x:e.width*.84,y:e.height*.65}),this.addChild(t),t.onTouchBegan=function(e,t){cc.eventManager.dispatchCustomEvent(SC.CHARACTER_SET_WEAPON,{weaponName:SH.Weapon.Characters.Rifle})},t.onTouchEnded=function(e,t){cc.eventManager.dispatchCustomEvent(SC.CHARACTER_RESET_WEAPON)}},initSkillPlusBt_2:function(){var e=cc.winSize,t=new ButtonNoEdg("plusBt.png");t.attr({x:e.width*.84,y:e.height*.51}),this.addChild(t)},initSkillPlusBt_3:function(){var e=cc.winSize,t=new ButtonNoEdg("plusBt.png");t.attr({x:e.width*.84,y:e.height*.35}),this.addChild(t)},initBulletPlusBt_1:function(){var e=cc.winSize,t=new ButtonNoEdg("plusBt.png");t.attr({x:e.width*.35,y:e.height*.65}),this.addChild(t)},initBulletPlusBt_2:function(){var e=cc.winSize,t=new ButtonNoEdg("plusBt.png");t.attr({x:e.width*.35,y:e.height*.51}),this.addChild(t)},initBulletPlusBt_3:function(){var e=cc.winSize,t=new ButtonNoEdg("plusBt.png");t.attr({x:e.width*.35,y:e.height*.35}),this.addChild(t)},initBoxHomeBt:function(){var e=cc.winSize,t=new ButtonNoEdg("boxBt.png");t.attr({x:e.width*.9,y:e.height*.9}),this.addChild(t)},initBackBt:function(){var e=cc.winSize,t=new ButtonNoEdg("backBt.png");t.attr({x:e.width*.1,y:e.height*.1}),this.addChild(t),t.onTouchBegan=function(e,t){cc.director.runScene(new cc.TransitionFade(.1,new StarGameScene))},t.onTouchEnded=function(e,t){}}});var ScriptLayer=cc.Layer.extend({ctor:function(){this._super(),this.bornBuffer={width:0,height:10},this.currentLevel=-1,this.scriptConfig=null,this.scriptType=-1,this.totalAmount4CurLvl=0,this.currentAmount=0,this.monsterLevel4CurLvl=0,this.flushMonsterStep=.5*SH.FPS,this.warningStep=1*SH.FPS,this.monsters4CurLvl=[],this.stop=!1,this.shouldAddMonster=!1,this.currentStatus="",this.framesData={},this.currentLevelHasBoss=!1,this.init(),this.addEventListener()},init:function(){},addEventListener:function(){cc.eventManager.addCustomListener(SC.CHARACTER_DIE,_.bind(function(){this.stop=!0},this)),cc.eventManager.addCustomListener(SC.CHARACTER_RESURRECTION,_.bind(function(){this.stop=!1},this))},initLevelMonsters:function(){this.currentLevelHasBoss=!1;var e=this.currentLevel;e>=this.scriptConfig.length&&(e=this.scriptConfig.length-1);var t=this.scriptConfig[e],n=t.monsters,r=t.elite;this.monsters4CurLvl=[];var i=[],s={},o=0,u=null;for(var a=0,f=n.length;a<f;a++){var l=n[a].id,c=parseInt(n[a].weight);for(var h in MonsterConfig)MonsterConfig[h].values[l]&&(i.push({key:h,monsterId:l,range:[o+1,o+c]}),o+=c)}for(var a=0;a<this.totalAmount4CurLvl;a++){var p=_.random(1,o);for(var d=0,f=i.length;d<f;d++)if(p>=i[d].range[0]&&p<=i[d].range[1]){var v=i[d].monsterId;this.monsters4CurLvl.push({key:i[d].key,monsterId:v,isBoss:!1}),s[v]||(s[v]=0),s[v]++;if(s[v]>s[u]||u==null)u=v}}for(var a=0,f=i.length;a<f;a++){var v=i[a].monsterId;if(!s[v]){this.monsters4CurLvl.push({key:i[a].key,monsterId:v,isBoss:!1}),s[v]=1,s[u]--;for(var d=0,m=this.monsters4CurLvl.length;d<m;d++)if(this.monsters4CurLvl[d].monsterId==u){this.monsters4CurLvl.splice(d,1);break}for(var h in s)s[h]>s[u]&&(u=h)}}if(r.length>0){var p=_.random(0,100),g=0,y=!1;for(var a=0,f=r.length;a<f;a++){var b=r[a];if(p>=g&&p<g+b.proportion){var w=b.monsterId;for(var E in MonsterConfig)if(MonsterConfig[E].values[w]){var S=E;MonsterConfig[E].values[w].isBoss&&(y=!0,this.currentLevelHasBoss=!0);break}if(y){this.monsters4CurLvl=[],this.monsters4CurLvl.push({key:S,monsterId:w,isBoss:!0});break}var x=_.random(b.min,b.max);for(var d=0;d<x;d++)this.monsters4CurLvl.push({key:S,monsterId:w,isBoss:!1});break}g+=b.proportion}}},start:function(e){this.scriptConfig=ScriptsConfig[e],this.refreshLevel()},refreshLevel:function(){var e=0;if(this.currentLevel==-1)e=.5,this.schedule(_.bind(function(){this.currentLevel++,this.refreshLevel()},this),e,0);else{var t=this.currentLevel;t>=this.scriptConfig.length&&(t=this.scriptConfig.length-1);var n=this.scriptConfig[t];this.totalAmount4CurLvl=_.random(parseInt(n.amount[0]),parseInt(n.amount[1])),this.monsterLevel4CurLvl=parseInt(n.level)+(this.currentLevel-t),this.flushMonsterStep=n.interval/1e3*SH.FPS,this.currentAmount=0,this.tempStep=0,this.warningStep=SH.FPS,this.currentStatus="MonsterBorn",this.initLevelMonsters(),cc.eventManager.dispatchCustomEvent(SC.BATTLE_ROUND_UPDATE,{currentLevel:this.currentLevel,monsters4CurrentLevel:this.monsters4CurLvl,hasBoss:this.currentLevelHasBoss})}},getMonsterCurrentLevel:function(){return this.monsterLevel4CurLvl},update:function(){switch(this.currentStatus){case"MonsterBorn":if(Monsters.monstersOnStage.length>=10||this.stop)return;if(this.tempStep==this.flushMonsterStep&&this.monsters4CurLvl.length>0){this.tempStep=0;var e=_.random(-1,1),t=_.random(-1,1);e==0&&t==0&&(e=-1);var n=cc.winSize.width/2,r=cc.winSize.height/2,i=this.monsters4CurLvl.pop(),s=cc.p(n+e*(n+100),r+t*(r+100));if(s.x<0||s.x>cc.winSize.width)s.y+=_.random(-300,300);else if(s.y<0||s.y>cc.winSize.height)s.x+=_.random(-300,300);var o=Monsters.create(this.parent,{name:i.key,monsterId:i.monsterId,bornPlace:s});o.start(),this.currentAmount++,this.shouldAddMonster=!0}this.tempStep++,this.monsters4CurLvl.length==0&&(this.currentStatus="MonsterBornFinished");break;case"MonsterBornFinished":var u=0;if(Monsters.monstersOnStage.length>5)return;for(var a=0;a<Monsters.monstersOnStage.length;a++)u++;if(this.shouldAddMonster&&this.monsters4CurLvl.length==0&&u<=0&&this.currentLevel>=0){var f=this.currentLevel;f>=this.scriptConfig.length&&(f=this.scriptConfig.length-1);var l=this.scriptConfig[f],c=parseInt(l.time);this.shouldAddMonster=!1,this.schedule(_.bind(function(){this.currentLevel++,this.refreshLevel()},this),c,0),this.currentStatus=""}}}});var BgLayer=cc.Layer.extend({ctor:function(){this._super(),this.init(),this.addListeners()},addListeners:function(){cc.eventManager.addCustomListener(SC.CHARACTER_BOMB,_.bind(function(e){this._shock()},this))},_shock:function(){var e=.02;this.runAction(cc.sequence(cc.sequence(cc.moveBy(e,cc.p(5,5)),cc.delayTime(e),cc.moveBy(e,cc.p(-5,-5)),cc.delayTime(e)).repeat(15),cc.callFunc(function(){this.x=0,this.y=0},this)))},init:function(){var e=cc.Sprite.create("res/bg.jpg");e.setPosition(cc.p(cc.winSize.width/2,cc.winSize.height/2)),this.addChild(e)},update:function(e){}});var BattleLayer=cc.Layer.extend({ctor:function(){this._super(),this._scriptLayer=null,this.init(),this.addListeners()},init:function(){var e=Character.create(SH.Character.Ironman,this);this.initScriptLayer()},addListeners:function(){cc.eventManager.addCustomListener(SC.GAME_START,_.bind(function(e){this._scriptLayer.start("1000")},this)),cc.eventManager.addCustomListener(SC.CHARACTER_BOMB,_.bind(function(e){this._shock()},this))},_shock:function(){var e=.02;this.runAction(cc.sequence(cc.sequence(cc.moveBy(e,cc.p(-10,-10)),cc.delayTime(e),cc.moveBy(e,cc.p(10,10)),cc.delayTime(e)).repeat(14),cc.callFunc(function(){this.x=0,this.y=0},this)))},initScriptLayer:function(){var e=new ScriptLayer;this.addChild(e),this._scriptLayer=e},getAllMosterInBattleLayer:function(){var e=[],t=this.getChildren();for(var n=0;n<t.length;n++){var r=t[n];r.getName()=="monster"&&r.visible&&e.push(r)}return e},update:function(e){Character.current.update&&Character.current.update(e),Bullet.updateAll(),this._scriptLayer.update(e)}});var DropItemLayer=cc.Layer.extend({ctor:function(){this._super(),this.init(),this.addListeners()},init:function(){},addListeners:function(){},update:function(e){}});var ControllLayer=cc.Layer.extend({ctor:function(){this._super(),this._moveJoyStickPannel=null,this._moveJoyStick=null,this.init()},init:function(){this.initJoyStick(),this.bindJoyStickEvent(),this.initRifleShootBtn(),this.initRocketShootBtn(),this.initElectricShootBtn(),this.initSkillBtn_1(),this.initSkillBtn_2(),this.initSkillBtn_3()},initJoyStick:function(){var e=new JoyStickPannel("#controlLayerUI_crossStick_bg.png","#controlLayerUI_crossStickBt.png");e.attr({x:cc.winSize.width/10,y:cc.winSize.height/8+30,scaleX:2,scaleY:2}),this.addChild(e),this._moveJoyStickPannel=e;var t=new JoyStick(cc.rect(e.x-e.buttomStick.width/2,e.y-e.buttomStick.height/2,e.buttomStick.width,e.buttomStick.height));this._moveJoyStick=t},bindJoyStickEvent:function(){cc.eventManager.addListener({event:cc.EventListener.TOUCH_ALL_AT_ONCE,swallowTouches:!0,onTouchesBegan:_.bind(this.onTouchesBegan,this),onTouchesMoved:_.bind(this.onTouchesMoved,this),onTouchesEnded:_.bind(this.onTouchesEnded,this)},this)},initRifleShootBtn:function(){var e=new ButtonNoEdg("controLayerUI_bulletBt_3.png");e.setPosition(cc.p(cc.winSize.width*7/8,80)),this.addChild(e),e.onTouchBegan=function(e,t){cc.eventManager.dispatchCustomEvent(SC.CHARACTER_SET_WEAPON,{weaponName:SH.Weapon.Characters.Rifle})},e.onTouchEnded=function(e,t){cc.eventManager.dispatchCustomEvent(SC.CHARACTER_RESET_WEAPON)}},initRocketShootBtn:function(){var e=new ButtonNoEdg("controLayerUI_bulletBt_2.png");e.setPosition(cc.p(cc.winSize.width*6/8,80)),this.addChild(e),e.onTouchBegan=function(e,t){cc.eventManager.dispatchCustomEvent(SC.CHARACTER_SET_WEAPON,{weaponName:SH.Weapon.Characters.Rocket})},e.onTouchEnded=function(e,t){cc.eventManager.dispatchCustomEvent(SC.CHARACTER_RESET_WEAPON)}},initElectricShootBtn:function(){var e=new ButtonNoEdg("controLayerUI_bulletBt_1.png");e.setPosition(cc.p(cc.winSize.width*5/8,80)),this.addChild(e),e.onTouchBegan=function(e,t){cc.eventManager.dispatchCustomEvent(SC.CHARACTER_SET_WEAPON,{weaponName:SH.Weapon.Characters.Electric})},e.onTouchEnded=function(e,t){cc.eventManager.dispatchCustomEvent(SC.CHARACTER_RESET_WEAPON)}},initSkillBtn_1:function(){var e=new ButtonNoEdg("controLayerUI_skillBt_1.png");e.attr({x:cc.winSize.width*.93,y:cc.winSize.height*.7}),this.addChild(e),e.onTouchBegan=function(e,t){cc.eventManager.dispatchCustomEvent(SC.CHARACTER_BOMB)},e.onTouchEnded=function(e,t){};var t=ULS.get(USK.PlayInfo).bombNum,n=new cc.LabelBMFont(t.toString(),MainRes.customFont.customBMFont_1_fnt);n.setScale(.7),n.setPosition(cc.p(e.x+20,e.y+20)),this.addChild(n)},initSkillBtn_2:function(){var e=new ButtonNoEdg("controLayerUI_skillBt_2.png");e.attr({x:cc.winSize.width*.93,y:cc.winSize.height*.54}),this.addChild(e),e.onTouchBegan=function(e,t){cc.eventManager.dispatchCustomEvent(SC.CHARACTER_FREEZE)};var t=ULS.get(USK.PlayInfo).freezeNum,n=new cc.LabelBMFont(t.toString(),MainRes.customFont.customBMFont_1_fnt);n.setScale(.7),n.setPosition(cc.p(e.x+20,e.y+20)),this.addChild(n)},initSkillBtn_3:function(){var e=new ButtonNoEdg("controLayerUI_skillBt_3.png");e.attr({x:cc.winSize.width*.93,y:cc.winSize.height*.38}),this.addChild(e),e.onTouchBegan=function(e,t){cc.eventManager.dispatchCustomEvent(SC.CHARACTER_SHIEL)};var t=ULS.get(USK.PlayInfo).shieldNum,n=new cc.LabelBMFont(t.toString(),MainRes.customFont.customBMFont_1_fnt);n.setScale(.7),n.setPosition(cc.p(e.x+20,e.y+20)),this.addChild(n)},onTouchesBegan:function(e,t){var n=t.getCurrentTarget();for(var r=0,i=e.length;r<i;++r){var s=e[r],o=n.getMoveJoyStick(),u=n.getMoveJoyStickPannel();!o.getBasePos()&&o.setBasePos(s.getLocation())&&(Character.current.setVelocity({vX:0,vY:0}),u.isTouchesBegan())}},onTouchesMoved:function(e,t){var n=t.getCurrentTarget();for(var r=0,i=e.length;r<i;++r){var s=e[r],o=n.getMoveJoyStick(),u=n.getMoveJoyStickPannel(),a=o.getDpos(s.getLocation());a&&(u.setStickPos(s.getLocation()),Character.current.setVelocity(a.target))}},onTouchesEnded:function(e,t){var n=t.getCurrentTarget();for(var r=0,i=e.length;r<i;++r){var s=e[r],o=n.getMoveJoyStick(),u=n.getMoveJoyStickPannel();Character.current.setVelocity({vX:0,vY:0}),u.setStickPos(u.getPosition()),o.resetPos(),u.isTouchesEnded()}},getMoveJoyStick:function(){return this._moveJoyStick},getMoveJoyStickPannel:function(){return this._moveJoyStickPannel},update:function(e){this._moveJoyStickPannel.update(e)}});var GameUILayer=cc.Layer.extend({_hpBarwidth:120,_hpBar:null,ctor:function(){this._super(),this.init()},init:function(){this.initImages(),this.initButtons(),this.initHpBar(),this.addEventListener(),this._initBulletRifle(),this._initBulletElectric(),this._initBulletRocket(),this._initStar()},addEventListener:function(){cc.eventManager.addCustomListener(SC.HP_UPDATE,_.bind(function(e){this.updateHp(e)},this))},updateHp:function(e){var t=e.getUserData(),n=t.HP/t.TotalHP;this._hpBar.setTextureRect(new cc.rect(0,0,this._hpBarwidth*n,20));var r=t.HP+"/"+t.TotalHP;this._hpBarLabel.setString(r.toString(),!0)},initHpBar:function(){var e=cc.winSize,t=new cc.Sprite("#gameLayerUI_hpBar.png");t.attr({x:.12*e.width-63,y:.9*e.height-8,anchorX:0,anchorY:0}),this._hpBarwidth=t.width,t.setTextureRect(new cc.rect(0,0,this._hpBarwidth,20)),this._hpBar=t,this.addChild(this._hpBar);var n="100/100";this._hpBarLabel=new cc.LabelBMFont(n,MainRes.customFont.customBMFont_3_fnt),this._hpBarLabel.setPosition(cc.p(this._hpBar.x+70,this._hpBar.y+15)),this.addChild(this._hpBarLabel)},initImages:function(){var e=cc.winSize,t=new cc.Sprite("#gameLayerUI_hpBar_bg.png");this.addChild(t),t.attr({x:.12*e.width,y:.9*e.height});var n=new cc.Sprite("#gameLayerUI_head.png");this.addChild(n),n.attr({x:.04*e.width,y:.92*e.height})},_initBulletRifle:function(){var e=cc.winSize,t=new cc.Sprite("#gameLayerUI_bullet_1.png");this.addChild(t),t.attr({x:.04*e.width,y:.82*e.height});var n=ULS.get(USK.PlayInfo).rifle,r=new cc.LabelBMFont(n,MainRes.customFont.customBMFont_1_fnt);r.setScale(.9),r.setPosition(cc.p(t.x+50,t.y-11)),this.addChild(r)},_initBulletElectric:function(){var e=cc.winSize,t=new cc.Sprite("#gameLayerUI_bullet_2.png");this.addChild(t),t.attr({x:.04*e.width,y:.72*e.height});var n=ULS.get(USK.PlayInfo).electric,r=new cc.LabelBMFont(n,MainRes.customFont.customBMFont_1_fnt);r.setScale(.9),r.setPosition(cc.p(t.x+50,t.y-10)),this.addChild(r)},_initBulletRocket:function(){var e=cc.winSize,t=new cc.Sprite("#gameLayerUI_bullet_3.png");this.addChild(t),t.attr({x:.04*e.width,y:.62*e.height});var n=ULS.get(USK.PlayInfo).rifle,r=new cc.LabelBMFont(n,MainRes.customFont.customBMFont_1_fnt);r.setScale(.9),r.setPosition(cc.p(t.x+50,t.y-11)),this.addChild(r)},_initStar:function(){var e=cc.winSize,t=new cc.Sprite("#star.png");this.addChild(t),t.attr({x:.4*e.width,y:.92*e.height});var n=ULS.get(USK.PlayInfo).score,r=new cc.LabelBMFont(n.toString(),MainRes.customFont.customBMFont_2_fnt);r.setScale(.9),r.setPosition(cc.p(t.x+90,t.y+5)),this.addChild(r)},initButtons:function(){var e=cc.winSize,t=new ButtonNoEdg("gameLayerUI_pauseBt.png");this.addChild(t),t.attr({x:.93*e.width,y:.9*e.height}),t.onTouchBegan=function(e,t){cc.director.pause();var n=new PauseLayer;n.setTag(1),n.setOpacity(255),g_gamelayer.addChild(n)};var n=new ButtonNoEdg("gameLayerUI_addHpBt.png");this.addChild(n),n.attr({x:.2*e.width,y:.9*e.height}),n.onTouchBegan=function(){g_gamelayer.gameUILayer._hpBarwidth+5>127?g_gamelayer.gameUILayer._hpBarwidth=127:g_gamelayer.gameUILayer._hpBarwidth+=5;var e=g_gamelayer.gameUILayer._hpBarwidth;g_gamelayer.gameUILayer._hpBar.setTextureRect(cc.rect(0,0,e,20))};var r=new ButtonNoEdg("gameLayerUI_boxHomeBt.png");this.addChild(r),r.attr({x:.8*e.width,y:.9*e.height});var i=new cc.Sprite("#gameLayerUI_boxRedPoint.png");this.addChild(i),i.attr({x:.83*e.width,y:.93*e.height})},update:function(e){}});var ExplosionMaskLayer=cc.LayerColor.extend({ctor:function(){this._super(cc.color(255,255,255,255)),this.init()},init:function(){this.visible=!1,this.addListeners()},addListeners:function(){cc.eventManager.addCustomListener(SC.CHARACTER_BOMB,_.bind(function(e){this._doExplosion()},this)),cc.eventManager.addCustomListener(SC.CHARACTER_FREEZE,_.bind(function(e){this._doFreeze()},this))},_doFreeze:function(){this.setColor(cc.color(118,233,241,255)),this.visible=!0;var e=.03;this.runAction(cc.sequence(cc.sequence(cc.fadeIn(e),cc.delayTime(e),cc.fadeOut(e),cc.delayTime(e)).repeat(2),cc.callFunc(function(){this.visible=!1,this._FreezeMonster()},this)))},_doExplosion:function(){this.setColor(cc.color(255,255,255,255)),this.visible=!0;var e=.03;this.runAction(cc.sequence(cc.sequence(cc.fadeIn(e),cc.delayTime(e),cc.fadeOut(e),cc.delayTime(e)).repeat(8),cc.callFunc(function(){this.visible=!1,this._killMonster()},this)))},_FreezeMonster:function(){var e=Monsters.monstersOnStage;for(var t=0,n=e.length;t<n;++t){var r=e[t];r.freezeMonstersByBomb()}this.scheduleOnce(function(){for(var t=0,n=e.length;t<n;++t){var r=e[t];r.freezeRelease()}},5)},_killMonster:function(){var e=Monsters.monstersOnStage;for(var t=0,n=e.length;t<n;++t){var r=e[t];r.active&&r.hitMonstersByBomb("Bomb")}},update:function(e){}});var PauseLayer=cc.Layer.extend({ctor:function(){this._super(),this.init()},init:function(){var e=new cc.Color(0,0,0,105),t=new cc.LayerColor(e,960,540);this.addChild(t);var n=new ButtonNoEdg("pauseScene_backBt.png");this.addChild(n),n.attr({x:cc.winSize.width/5*2,y:cc.winSize.height/5*3}),n.onTouchBegan=function(){cc.director.resume(),cc.director.runScene(new cc.TransitionFade(.1,new StarGameScene))};var r=new ButtonNoEdg("pauseScene_resumeBt.png");this.addChild(r),r.attr({x:cc.winSize.width/5*3,y:cc.winSize.height/5*3}),r.onTouchBegan=function(){cc.director.resume(),g_gamelayer.removeChildByTag(1)};var i=new ButtonNoEdg("pauseScene_soundBt.png");this.addChild(i),i.attr({x:cc.winSize.width/2,y:cc.winSize.height/5*2})}});var GameOverLayer=cc.Layer.extend({ctor:function(){this._super(),this.init()},init:function(){this.initImages(),this.initButtons()},initImages:function(){var e=new cc.Color(0,0,0,105),t=new cc.LayerColor(e,960,540);this.addChild(t);var n=new cc.Sprite("#gameOverTitle.png");this.addChild(n),n.attr({x:cc.winSize.width/2,y:cc.winSize.height/7*5});var r=new cc.Sprite("#bigStar.png");this.addChild(r),r.attr({x:cc.winSize.width/8*3,y:cc.winSize.height/2})},initButtons:function(){var e=new ButtonNoEdg("gameOvewBackBt.png");this.addChild(e),e.attr({x:cc.winSize.width/2,y:cc.winSize.height/7*2}),e.onTouchBegan=function(){cc.director.runScene(new cc.TransitionFade(.1,new StarGameScene))}}});var MainRes={customFont:{customBMFont_1_fnt:"res/font/f1.fnt",customBMFont_1_png:"res/font/f1_0.png",customBMFont_2_fnt:"res/font/f2.fnt",customBMFont_2_png:"res/font/f2_0.png",customBMFont_3_fnt:"res/font/f3.fnt",customBMFont_3_png:"res/font/f3_0.png"},mainMenu:{i_mainMenu:"res/gameUI/mainMenuUI.png",p_mainMenu:"res/gameUI/mainMenuUI.plist"}},LoadingRes={},GameRes={skills:{png:"res/skills/Shield.png"},monsterFreezeExplode:{plist:"res/monsters/freeze.plist",png:"res/monsters/freeze.png"},monsterBombExplode:{plist:"res/monsters/BombEffect.plist",png:"res/monsters/BombEffect.png"},monsterExplode:{plist:"res/monsters/weaponEffect.plist",png:"res/monsters/weaponEffect.png"},test:{i_bg:"res/bg.jpg",i_character:"res/characters/character.png",p_character:"res/characters/character.plist"},starGameUILayer:{i_starGameUILayer:"res/StarGameUI/StarGameUI.png",p_starGameUILayer:"res/StarGameUI/StarGameUI.plist"},userFiles:{i_userfiles:"res/userFilesScene/userFilesScene.png",p_userfiles:"res/userFilesScene/userFilesScene.plist"},controlLayerUI:{i_controlLayerUI:"res/controlLayerUI/controlLayerUI.png",p_controlLayerUI:"res/controlLayerUI/controlLayerUI.plist"},pauseSceneUI:{i_pauseSceneUI:"res/PauseSceneUI/PauseSceneUI.png",p_pauseSceneUI:"res/PauseSceneUI/PauseSceneUI.plist"},gameOverLayerUI:{i_gameOverLayerUI:"res/gameOverLayerUI/gameOverLayer.png",p_gameOverLayerUI:"res/gameOverLayerUI/gameOverLayer.plist"},gameLayerUI:{i_gameLayerUI:"res/gameLayerUI/gameLayerUI.png",p_gameLayerUI:"res/gameLayerUI/gameLayerUI.plist"},characterRifleWeapon:{plist:"res/characters/CharacterWeapon.png",png:"res/characters/CharacterWeapon.plist",rocketExplodePng:"res/characters/RocketEffect.png",rocketExplodePlist:"res/characters/RocketEffect.plist"},characterElectricWeapon:{plist:"res/characters/electric.png",png:"res/characters/electric.plist"},shaders:{whiteHit:{fsh:"res/shaders/whiteHit.fsh",vsh:"res/shaders/whiteHit.vsh",vsh_noMVP:"res/shaders/whiteHit_noMVP.vsh"},whiteHitRecover:{fsh:"res/shaders/whiteHitRecover.fsh",vsh:"res/shaders/whiteHitRecover.vsh",vsh_noMVP:"res/shaders/whiteHitRecover_noMVP.vsh"}},monsterAlpha:{plist:"res/monsters/Alpha.plist",png:"res/monsters/Alpha.png"},monsterBeta:{plist:"res/monsters/Beta.plist",png:"res/monsters/Beta.png"},monsterCharlie:{plist:"res/monsters/monsters.plist",png:"res/monsters/monsters.png"}},main_resources=[],game_resources=[],loading_resource=[],loopRes=function(e,t,n){if(_.isObject(e[t]))for(var r in e[t])loopRes(e[t],r,n);else _.indexOf(n,e[t])<0&&n.push(e[t])};(function(){for(var e in LoadingRes)loopRes(LoadingRes,e,loading_resource);for(var e in MainRes)loopRes(MainRes,e,main_resources);for(var e in GameRes)loopRes(GameRes,e,game_resources)})();var AppScene=cc.Scene.extend({onEnterTransitionDidFinish:function(){this._super();var e=new AppLayer;this.addChild(e)}}),AppLayer=cc.Layer.extend({ctor:function(){this._super(),this.initStorage(),cc.loader.load(game_resources,function(e,t,n){},_.bind(function(){this.schedule(_.bind(function(){this.addPlist(),cc.director.runScene(new cc.TransitionFade(.1,new MainLoadingScene))},this),.1,0)},this))},initStorage:function(){ULS.get(USK.PlayInfo)==null&&ULS.set(USK.PlayInfo,{score:0,electric:100,rocket:100,rifle:100,bombNum:5,freezeNum:5,shieldNum:3}),null==ULS.get(USK.GameInfo)&&ULS.set(USK.GameInfo,{soundVolume:100,musicVolume:100}),Audio.setMusicVolume(ULS.get(USK.GameInfo).musicVolume),Audio.setEffectsVolume(ULS.get(USK.GameInfo).soundVolume)},addPlist:function(){for(var e=0,t=game_resources.length;e<t;e++)game_resources[e].indexOf(".png")>0?cc.textureCache.addImage(game_resources[e]):game_resources[e].indexOf(".plist")>0&&cc.spriteFrameCache.addSpriteFrames(game_resources[e])}});